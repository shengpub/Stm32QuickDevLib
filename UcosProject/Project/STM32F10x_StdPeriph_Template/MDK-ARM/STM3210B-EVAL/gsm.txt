; generated by Component: ARM Compiler 5.06 update 4 (build 422) Tool: ArmCC [4d3604]
; commandline ArmCC [--list --split_sections --debug -c --asm --interleave -o.\stm3210b-eval\gsm.o --asm_dir=.\STM3210B-EVAL\ --list_dir=.\STM3210B-EVAL\ --depend=.\stm3210b-eval\gsm.d --cpu=Cortex-M3 --apcs=interwork -O3 --diag_suppress=9931 -I..\ -I..\..\..\Libraries\CMSIS\CM3\CoreSupport -I..\..\..\Libraries\CMSIS\CM3\DeviceSupport\ST\STM32F10x -I..\..\..\Libraries\STM32F10x_StdPeriph_Driver\inc -I..\..\..\Utilities\STM32_EVAL -I..\..\..\Utilities\STM32_EVAL\STM3210B_EVAL -I..\..\..\Utilities\STM32_EVAL\Common -I..\Bsp -I..\MQTT -IC:\Users\gavinX\Desktop\GetWifiInfo\Project\STM32F10x_StdPeriph_Template\MDK-ARM\RTE\_STM32Project -Ie:\Keil_v5\ARM\PACK\Keil\STM32F1xx_DFP\1.1.0\Device\Include -Ie:\Keil_v5\ARM\CMSIS\Include -D__MICROLIB -D__UVISION_VERSION=522 -DSTM32F10X_HD -DSTM32F10X_HD -DUSE_STDPERIPH_DRIVER --omf_browse=.\stm3210b-eval\gsm.crf ..\User\Gsm.c]
                          THUMB

                          AREA ||i.CleanGsmRsp||, CODE, READONLY, ALIGN=2

                  CleanGsmRsp PROC
;;;15     /*清楚接史祷剀*/
;;;16     uint8_t CleanGsmRsp()
000000  b510              PUSH     {r4,lr}
;;;17     {
;;;18     	uint16_t uiLoop =0;
;;;19     	
;;;20     	memset(&mdGsm.sGsmComInfo.RecvMessage[0],0,GSM_RECV_BUFF_LEN);
000002  f44f6180          MOV      r1,#0x400
000006  4802              LDR      r0,|L1.16|
000008  f7fffffe          BL       __aeabi_memclr
;;;21     	
;;;22     	//mdGsm.uiGsmUsartFlag &=~GSM_RECV_NEW_DATA;
;;;23     	
;;;24     	return 1;
00000c  2001              MOVS     r0,#1
;;;25     }
00000e  bd10              POP      {r4,pc}
;;;26     /*检查模块回复中的ok*/
                          ENDP

                  |L1.16|
                          DCD      ||.bss||

                          AREA ||i.GsmConnectDel||, CODE, READONLY, ALIGN=2

                  GsmConnectDel PROC
;;;161    /*gsm模块连接处理，主要负责连接到网络*/
;;;162    uint16_t GsmConnectDel()
000000  b510              PUSH     {r4,lr}
;;;163    {
;;;164    	if(!(mdGsm.uiGsmUsartFlag & GSM_OPEN_SYS_LOGIN))
000002  4c15              LDR      r4,|L2.88|
000004  f8b40604          LDRH     r0,[r4,#0x604]  ; mdGsm
000008  0781              LSLS     r1,r0,#30
00000a  d40b              BMI      |L2.36|
;;;165    	{
;;;166    		/*模块未执行过开机登录服务器操作*/
;;;167    		/*接下来就进行登录操作*/
;;;168    		mdGsm.uiGsmSingnelValue = 0;
00000c  2100              MOVS     r1,#0
00000e  f8a41606          STRH     r1,[r4,#0x606]
;;;169    		/*如果处于开机状态则首先需要关闭模块一次，然后再从新开机模块*/
;;;170    		if(mdGsm.uiGsmUsartFlag & GSM_OPEN_SYS_STATE)
000012  0741              LSLS     r1,r0,#29
000014  d511              BPL      |L2.58|
;;;171    		{
;;;172    			/*如果已经注册成功了。因该首先关闭gprs链路，然后再关闭模块，
;;;173    				否则，直接关闭模块就可以了*/
;;;174    			if(mdGsm.uiGsmUsartFlag & GSM_LOGIN_OK)
000016  0701              LSLS     r1,r0,#28
000018  d505              BPL      |L2.38|
;;;175    			{
;;;176    				/*清楚模块注册完成*/
;;;177    				mdGsm.uiGsmUsartFlag &=~GSM_LOGIN_OK;/*清楚模块正在开机过程中*/
00001a  f0200008          BIC      r0,r0,#8
00001e  f8a40604          STRH     r0,[r4,#0x604]
;;;178    				return 1;
000022  2001              MOVS     r0,#1
                  |L2.36|
;;;179    			}
;;;180    			else
;;;181    			{
;;;182    				/*直接关闭模块*/
;;;183    				GPIO_SetBits(GSM_ON_PORT,GSM_ON);/*关闭模块*/
;;;184    				mdGsm.uiGsmUsartFlag &=~GSM_LOGIN_OK;/*清楚模块正在开机过程中*/
;;;185    			}
;;;186    			
;;;187    		}
;;;188    		/*模块未处于开机状态，则进行开机操作*/
;;;189    		else
;;;190    		{
;;;191    			if(GsmOpenDel())/*开机成功*/
;;;192    			{
;;;193    				LedOpen(LED1);
;;;194    				mdGsm.uiGsmUsartFlag |= GSM_OPEN_SYS_STATE;/*模块处于开机状态*/
;;;195    				mdGsm.uiGsmUsartFlag |= GSM_OPEN_SYS_LOGIN;/*模块进行过开机登录操作*/
;;;196    			}
;;;197    		}
;;;198    	}
;;;199    	
;;;200    }
000024  bd10              POP      {r4,pc}
                  |L2.38|
000026  f44f7180          MOV      r1,#0x100             ;183
00002a  480c              LDR      r0,|L2.92|
00002c  f7fffffe          BL       GPIO_SetBits
000030  f8b40604          LDRH     r0,[r4,#0x604]        ;184  ; mdGsm
000034  f0200008          BIC      r0,r0,#8              ;184
000038  e00a              B        |L2.80|
                  |L2.58|
00003a  f7fffffe          BL       GsmOpenDel
00003e  2800              CMP      r0,#0                 ;191
000040  d0f0              BEQ      |L2.36|
000042  2001              MOVS     r0,#1                 ;193
000044  f7fffffe          BL       LedOpen
000048  f8b40604          LDRH     r0,[r4,#0x604]        ;194  ; mdGsm
00004c  f0400006          ORR      r0,r0,#6              ;195
                  |L2.80|
000050  f8a40604          STRH     r0,[r4,#0x604]        ;184
000054  bd10              POP      {r4,pc}
;;;201    /*读取模块版本号码,准备数据*/
                          ENDP

000056  0000              DCW      0x0000
                  |L2.88|
                          DCD      ||.bss||
                  |L2.92|
                          DCD      0x40010800

                          AREA ||i.GsmConnectServer||, CODE, READONLY, ALIGN=1

                  GsmConnectServer PROC
;;;871    /*gsm模块连接到服务器*/
;;;872    uint16_t GsmConnectServer()
000000  4770              BX       lr
;;;873    {
;;;874    	
;;;875    }
;;;876    /*gsm服务器连接处理，主要负责连接到服务器*/
                          ENDP


                          AREA ||i.GsmConnetDel||, CODE, READONLY, ALIGN=2

                  GsmConnetDel PROC
;;;876    /*gsm服务器连接处理，主要负责连接到服务器*/
;;;877    uint16_t GsmConnetDel()
000000  4807              LDR      r0,|L4.32|
;;;878    {
;;;879    	/*tcp0连接不成功*/
;;;880    	if(!(mdGsm.uiGsmTcpLinkState[0] & TCP_CONNECT_OK))
000002  f8b01612          LDRH     r1,[r0,#0x612]  ; mdGsm
000006  07ca              LSLS     r2,r1,#31
000008  d107              BNE      |L4.26|
;;;881    	{
;;;882    		/*是否启用tcp0启动连接*/
;;;883    		if(mdGsm.uiGsmTcpChanleEnableState[0] & TCP_BEGIN_USE)
00000a  f890261c          LDRB     r2,[r0,#0x61c]  ; mdGsm
00000e  0792              LSLS     r2,r2,#30
000010  d503              BPL      |L4.26|
;;;884    		{
;;;885    			mdGsm.uiGsmTcpLinkState[0] |= TCP_CONNECT_OK;/*tcp正在连接过程中*/
000012  f0410101          ORR      r1,r1,#1
000016  f8a01612          STRH     r1,[r0,#0x612]
                  |L4.26|
;;;886    			GsmConnectServer();
;;;887    		}
;;;888    	}
;;;889    	return 0;
00001a  2000              MOVS     r0,#0
;;;890    }
00001c  4770              BX       lr
;;;891    /*gsm模块处理函数*/
                          ENDP

00001e  0000              DCW      0x0000
                  |L4.32|
                          DCD      ||.bss||

                          AREA ||i.GsmGpioControl||, CODE, READONLY, ALIGN=1

                  GsmGpioControl PROC
;;;944    /*gsm模块io口高低电平控制*/
;;;945    uint16_t GsmGpioControl(GPIO_TypeDef* GPIO,uint16_t GPIO_Pin,uint8_t State)
000000  b510              PUSH     {r4,lr}
;;;946    {
000002  b112              CBZ      r2,|L5.10|
;;;947    	if(State)
;;;948    	{
;;;949    		GPIO_SetBits(GPIO,GPIO_Pin);
000004  f7fffffe          BL       GPIO_SetBits
;;;950    	}
;;;951    	else
;;;952    	{
;;;953    		GPIO_ResetBits(GPIO,GPIO_Pin);
;;;954    	}
;;;955    }
000008  bd10              POP      {r4,pc}
                  |L5.10|
00000a  f7fffffe          BL       GPIO_ResetBits
00000e  bd10              POP      {r4,pc}
;;;956    /*gsm模块端口初始化*/
                          ENDP


                          AREA ||i.GsmLogin||, CODE, READONLY, ALIGN=2

                  GsmLogin PROC
;;;739    /*模块注册登录*/
;;;740    uint16_t GsmLogin()
000000  b510              PUSH     {r4,lr}
;;;741    {
;;;742    	switch(mdGsm.GsmLoginStep)
000002  4c2b              LDR      r4,|L6.176|
000004  f894060c          LDRB     r0,[r4,#0x60c]  ; mdGsm
000008  2814              CMP      r0,#0x14
00000a  d233              BCS      |L6.116|
00000c  e8dff000          TBB      [pc,r0]
000010  320a1016          DCB      0x32,0x0a,0x10,0x16
000014  1b202527          DCB      0x1b,0x20,0x25,0x27
000018  3436383a          DCB      0x34,0x36,0x38,0x3a
00001c  3c3e4042          DCB      0x3c,0x3e,0x40,0x42
000020  4446484a          DCB      0x44,0x46,0x48,0x4a
;;;743    	{
;;;744    		case GSM_LOGIN_STEP_READ_VERSION:
;;;745    			if(ReadGsmCGMR())
000024  f7fffffe          BL       ReadGsmCGMR
000028  2800              CMP      r0,#0
00002a  d023              BEQ      |L6.116|
;;;746    			{
;;;747    				LogMsgStr(LOG_DEBUG,"ReadGsmCGMR ok\r\n");
00002c  a021              ADR      r0,|L6.180|
;;;748    				mdGsm.GsmLoginStep++;
00002e  e01a              B        |L6.102|
;;;749    			}
;;;750    			break;
;;;751    		case GSM_LOGIN_STEP_READ_IMEI:
;;;752    			if(ReadGsmCGSN())
000030  f7fffffe          BL       ReadGsmCGSN
000034  2800              CMP      r0,#0
000036  d01d              BEQ      |L6.116|
;;;753    			{
;;;754    				LogMsgStr(LOG_DEBUG,"ReadGsmCGSN ok\r\n");
000038  a023              ADR      r0,|L6.200|
;;;755    				mdGsm.GsmLoginStep++;
00003a  e014              B        |L6.102|
;;;756    			}
;;;757    			break;
;;;758    		/*读取卡状态*/
;;;759    		case GSM_LOGIN_STEP_READ_SIM_S:
;;;760    			if(ReadSIMINS())
00003c  f7fffffe          BL       ReadSIMINS
000040  b1c0              CBZ      r0,|L6.116|
;;;761    			{
;;;762    				printf("ReadSIMINS ok\r\n");
000042  a026              ADR      r0,|L6.220|
;;;763    				mdGsm.GsmLoginStep++;
000044  e00f              B        |L6.102|
;;;764    			}
;;;765    			break;
;;;766    			/*读取PIN号码*/
;;;767    		case GSM_LOGIN_STEP_READ_PIN_N:
;;;768    			if(ReadGsmPIN())
000046  f7fffffe          BL       ReadGsmPIN
00004a  b198              CBZ      r0,|L6.116|
;;;769    			{
;;;770    				LogMsgStr(LOG_DEBUG,"ReadGsmPIN ok\r\n");
00004c  a027              ADR      r0,|L6.236|
;;;771    				mdGsm.GsmLoginStep++;
00004e  e00a              B        |L6.102|
;;;772    			}
;;;773    			break;
;;;774    			/*读取网络注册格式*/
;;;775    		case GSM_LOGIN_STEP_READ_COPS:
;;;776    			if(ReadGsmCOPS())
000050  f7fffffe          BL       ReadGsmCOPS
000054  b170              CBZ      r0,|L6.116|
;;;777    			{
;;;778    				LogMsgStr(LOG_DEBUG,"ReadGsmCOPS ok\r\n");
000056  a029              ADR      r0,|L6.252|
;;;779    				mdGsm.GsmLoginStep++;
000058  e005              B        |L6.102|
;;;780    			}
;;;781    			break;
;;;782    			/*读取信号量强度*/
;;;783    		case GSM_LOGIN_STEP_READ_CSQ:
;;;784    			//if(ReadGsmCSQ())
;;;785    			{
;;;786    				LogMsgStr(LOG_DEBUG,"ReadGsmCSQ ok\r\n");
00005a  a02d              ADR      r0,|L6.272|
;;;787    				mdGsm.GsmLoginStep++;
;;;788    			}
;;;789    			break;
00005c  e003              B        |L6.102|
;;;790    			/*运营商*/
;;;791    		case GSM_LOGIN_STEP_READ_COPSS:
;;;792    			if(ReadGsmCOPSS())
00005e  f7fffffe          BL       ReadGsmCOPSS
000062  b138              CBZ      r0,|L6.116|
;;;793    			{
;;;794    				LogMsgStr(LOG_DEBUG,"ReadGsmCOPSS ok\r\n");
000064  a02e              ADR      r0,|L6.288|
                  |L6.102|
000066  f7fffffe          BL       __2printf
;;;795    				mdGsm.GsmLoginStep++;
00006a  f894060c          LDRB     r0,[r4,#0x60c]  ; mdGsm
00006e  1c40              ADDS     r0,r0,#1
                  |L6.112|
000070  f884060c          STRB     r0,[r4,#0x60c]
                  |L6.116|
;;;796    			}
;;;797    			break;
;;;798    			/*设置网络注册报告*/
;;;799    		case GSM_LOGIN_STEP_SET_CREG:
;;;800    			mdGsm.GsmLoginStep++;
;;;801    			break;
;;;802    			/*读取网络注册报告*/
;;;803    		case GSM_LOGIN_STEP_READ_CREG:
;;;804    			mdGsm.GsmLoginStep++;
;;;805    			break;
;;;806    			/*设置短信模式*/
;;;807    		case GSM_LOGIN_STEP_SET_CMGF:
;;;808    			mdGsm.GsmLoginStep++;
;;;809    			break;
;;;810    		/*读取短信字符集*/
;;;811    		case GSM_LOGIN_STEP_READ_CSCS:
;;;812    			mdGsm.GsmLoginStep++;
;;;813    			break;
;;;814    		/*设置中心号码*/
;;;815    		case GSM_LOGIN_STEP_SET_CENTER:
;;;816    			mdGsm.GsmLoginStep++;
;;;817    			break;
;;;818    		/*设置pdp上网参数*/
;;;819    		case GSM_LOGIN_STEP_SET_PDP:
;;;820    			mdGsm.GsmLoginStep++;
;;;821    			break;
;;;822    		/*激活上网参数*/
;;;823    		case GSM_LOGIN_STEP_USE_PDP:
;;;824    			mdGsm.GsmLoginStep++;
;;;825    			break;
;;;826    		/*设置gprs附着参数*/
;;;827    		case GSM_LOGIN_STEP_SET_CGATT:
;;;828    			mdGsm.GsmLoginStep++;
;;;829    			break;
;;;830    		/*设置拨号参数*/
;;;831    		case GSM_LOGIN_STEP_SET_ZPNUM:
;;;832    			mdGsm.GsmLoginStep++;
;;;833    			break;
;;;834    		/*打开gprs上网链路*/
;;;835    		case GSM_LOGIN_STEP_SET_ZPPPOPEN:
;;;836    			mdGsm.GsmLoginStep++;
;;;837    			break;
;;;838    		/*获取本地ip地址*/
;;;839    		case GSM_LOGIN_STEP_SET_ZIPGETIP:
;;;840    			mdGsm.GsmLoginStep++;
;;;841    			break;
;;;842    		/*获取dsn*/
;;;843    		case GSM_login_STEP_SET_ZDNSSERV:
;;;844    			mdGsm.GsmLoginStep++;
;;;845    			return 1;
;;;846    			break;
;;;847    		default:
;;;848    			break;
;;;849    	}
;;;850    	
;;;851    	return 0;/*错误返回*/
000074  2000              MOVS     r0,#0
;;;852    }
000076  bd10              POP      {r4,pc}
000078  2009              MOVS     r0,#9                 ;800
00007a  e7f9              B        |L6.112|
00007c  200a              MOVS     r0,#0xa               ;804
00007e  e7f7              B        |L6.112|
000080  200b              MOVS     r0,#0xb               ;808
000082  e7f5              B        |L6.112|
000084  200c              MOVS     r0,#0xc               ;812
000086  e7f3              B        |L6.112|
000088  200d              MOVS     r0,#0xd               ;816
00008a  e7f1              B        |L6.112|
00008c  200e              MOVS     r0,#0xe               ;820
00008e  e7ef              B        |L6.112|
000090  200f              MOVS     r0,#0xf               ;824
000092  e7ed              B        |L6.112|
000094  2010              MOVS     r0,#0x10              ;828
000096  e7eb              B        |L6.112|
000098  2011              MOVS     r0,#0x11              ;832
00009a  e7e9              B        |L6.112|
00009c  2012              MOVS     r0,#0x12              ;836
00009e  e7e7              B        |L6.112|
0000a0  2013              MOVS     r0,#0x13              ;840
0000a2  e7e5              B        |L6.112|
0000a4  2014              MOVS     r0,#0x14              ;844
0000a6  f884060c          STRB     r0,[r4,#0x60c]        ;844
0000aa  2001              MOVS     r0,#1                 ;845
0000ac  bd10              POP      {r4,pc}
;;;853    /*模块注册登录处理*/
                          ENDP

0000ae  0000              DCW      0x0000
                  |L6.176|
                          DCD      ||.bss||
                  |L6.180|
0000b4  52656164          DCB      "ReadGsmCGMR ok\r\n",0
0000b8  47736d43
0000bc  474d5220
0000c0  6f6b0d0a
0000c4  00      
0000c5  00                DCB      0
0000c6  00                DCB      0
0000c7  00                DCB      0
                  |L6.200|
0000c8  52656164          DCB      "ReadGsmCGSN ok\r\n",0
0000cc  47736d43
0000d0  47534e20
0000d4  6f6b0d0a
0000d8  00      
0000d9  00                DCB      0
0000da  00                DCB      0
0000db  00                DCB      0
                  |L6.220|
0000dc  52656164          DCB      "ReadSIMINS ok\r\n",0
0000e0  53494d49
0000e4  4e53206f
0000e8  6b0d0a00
                  |L6.236|
0000ec  52656164          DCB      "ReadGsmPIN ok\r\n",0
0000f0  47736d50
0000f4  494e206f
0000f8  6b0d0a00
                  |L6.252|
0000fc  52656164          DCB      "ReadGsmCOPS ok\r\n",0
000100  47736d43
000104  4f505320
000108  6f6b0d0a
00010c  00      
00010d  00                DCB      0
00010e  00                DCB      0
00010f  00                DCB      0
                  |L6.272|
000110  52656164          DCB      "ReadGsmCSQ ok\r\n",0
000114  47736d43
000118  5351206f
00011c  6b0d0a00
                  |L6.288|
000120  52656164          DCB      "ReadGsmCOPSS ok\r\n",0
000124  47736d43
000128  4f505353
00012c  206f6b0d
000130  0a00    
000132  00                DCB      0
000133  00                DCB      0

                          AREA ||i.GsmLoginDel||, CODE, READONLY, ALIGN=2

                  GsmLoginDel PROC
;;;853    /*模块注册登录处理*/
;;;854    uint16_t GsmLoginDel()
000000  b510              PUSH     {r4,lr}
;;;855    {
;;;856    	/*模块未注册完成，接下来进行注册登录*/
;;;857    	if(!(mdGsm.uiGsmUsartFlag & GSM_LOGIN_OK))
000002  4c0a              LDR      r4,|L7.44|
000004  f8940604          LDRB     r0,[r4,#0x604]  ; mdGsm
000008  0700              LSLS     r0,r0,#28
00000a  d40c              BMI      |L7.38|
;;;858    	{
;;;859    		if(GsmLogin())
00000c  f7fffffe          BL       GsmLogin
000010  b148              CBZ      r0,|L7.38|
;;;860    		{
;;;861    			mdGsm.uiGsmUsartFlag |= GSM_LOGIN_OK;
000012  f8b40604          LDRH     r0,[r4,#0x604]  ; mdGsm
000016  f4206080          BIC      r0,r0,#0x400
;;;862    			/*模块处理成功*/
;;;863    			mdGsm.uiGsmUsartFlag &=~GSM_REBOOT_ING;
00001a  f0400008          ORR      r0,r0,#8
00001e  f8a40604          STRH     r0,[r4,#0x604]
;;;864    			/*清楚模块正在重启过程中*/
;;;865    			return 1;
000022  2001              MOVS     r0,#1
;;;866    		}
;;;867    		
;;;868    	}
;;;869    	return 0;
;;;870    }
000024  bd10              POP      {r4,pc}
                  |L7.38|
000026  2000              MOVS     r0,#0                 ;869
000028  bd10              POP      {r4,pc}
;;;871    /*gsm模块连接到服务器*/
                          ENDP

00002a  0000              DCW      0x0000
                  |L7.44|
                          DCD      ||.bss||

                          AREA ||i.GsmModeDel||, CODE, READONLY, ALIGN=2

                  GsmModeDel PROC
;;;891    /*gsm模块处理函数*/
;;;892    uint16_t GsmModeDel()
000000  490e              LDR      r1,|L8.60|
;;;893    {
000002  b510              PUSH     {r4,lr}
;;;894    	/*串口初始化未完成*/
;;;895    	if(!(mdGsm.uiGsmUsartFlag & GSM_USART_INIT_OK))
000004  f8b10604          LDRH     r0,[r1,#0x604]  ; mdGsm
000008  07c2              LSLS     r2,r0,#31
00000a  d009              BEQ      |L8.32|
;;;896    	{
;;;897    		/*gsm模块串口未初始化成功*/
;;;898    		mdGsm.uiGsmUsartFlag |= GSM_USART_INIT_OK;/*gsm模块串口初始化完成*/
;;;899    		SysGsmInit();/*这个函数只需要调用一次*/
;;;900    		GsmGpioControl(GSM_ON_PORT, GSM_ON,0);/*拉高*/
;;;901    		return 1;
;;;902    	}
;;;903    	/*gsm模块连接处理*/
;;;904    	if(!GsmConnectDel())
00000c  f7fffffe          BL       GsmConnectDel
000010  b190              CBZ      r0,|L8.56|
;;;905    	{
;;;906    		return 1;
;;;907    	}
;;;908    	/*gsm模块登录处理*/
;;;909    	if(!GsmLoginDel())
000012  f7fffffe          BL       GsmLoginDel
000016  b178              CBZ      r0,|L8.56|
;;;910    	{
;;;911    		return 1;
;;;912    	}
;;;913    	//if(GsmConnetDel())
;;;914    	{
;;;915    		//return 1;
;;;916    	}
;;;917    	LedClose(LED1);
000018  2001              MOVS     r0,#1
00001a  f7fffffe          BL       LedClose
;;;918    }
00001e  bd10              POP      {r4,pc}
                  |L8.32|
000020  f0400001          ORR      r0,r0,#1              ;898
000024  f8a10604          STRH     r0,[r1,#0x604]        ;898
000028  f7fffffe          BL       SysGsmInit
00002c  2200              MOVS     r2,#0                 ;900
00002e  f44f7180          MOV      r1,#0x100             ;900
000032  4803              LDR      r0,|L8.64|
000034  f7fffffe          BL       GsmGpioControl
                  |L8.56|
000038  2001              MOVS     r0,#1                 ;911
00003a  bd10              POP      {r4,pc}
;;;919    
                          ENDP

                  |L8.60|
                          DCD      ||.bss||
                  |L8.64|
                          DCD      0x40010800

                          AREA ||i.GsmOpenDel||, CODE, READONLY, ALIGN=2

                  GsmOpenDel PROC
;;;109    /*gsm模块开机处理*/
;;;110    uint16_t GsmOpenDel()
000000  b570              PUSH     {r4-r6,lr}
;;;111    {
;;;112    	/*模块不在开机和关机状态中*/
;;;113    	if(!(mdGsm.uiGsmUsartFlag & GSM_OPEN_OR_CLOSE_STATE))
000002  4c2b              LDR      r4,|L9.176|
;;;114    	{
;;;115    		mdGsm.uiGsmOpenOrCloseKeepTime = GSM_KEEP_OPEN_OR_CLOSE_TIME;
;;;116    		GsmGpioControl(GSM_ON_PORT,GSM_ON,1);/*拉低*/
000004  4e2b              LDR      r6,|L9.180|
000006  f44f7580          MOV      r5,#0x100
00000a  f8940604          LDRB     r0,[r4,#0x604]        ;113  ; mdGsm
00000e  06c0              LSLS     r0,r0,#27             ;113
000010  d40f              BMI      |L9.50|
000012  200a              MOVS     r0,#0xa               ;115
000014  f8a4060a          STRH     r0,[r4,#0x60a]        ;115
000018  2201              MOVS     r2,#1
00001a  4629              MOV      r1,r5
00001c  4630              MOV      r0,r6
00001e  f7fffffe          BL       GsmGpioControl
;;;117    		mdGsm.uiGsmUsartFlag |= GSM_MODE_TEST;
000022  f8b40604          LDRH     r0,[r4,#0x604]  ; mdGsm
;;;118    		mdGsm.uiGsmUsartFlag |= GSM_OPEN_OR_CLOSE_STATE;/*模块处于开机或关机状态*/
000026  f0200020          BIC      r0,r0,#0x20
;;;119    		mdGsm.uiGsmUsartFlag &= ~GSM_OPEN_OR_CLOSE_KEEP_FLAGE;
00002a  f4407088          ORR      r0,r0,#0x110
00002e  f8a40604          STRH     r0,[r4,#0x604]
                  |L9.50|
;;;120    		/*清楚模块关机或开机状态时间保持不变状态，开启开关机保持时间倒计时*/	
;;;121    	}
;;;122    	/*开始倒计时*/
;;;123    	if(!(mdGsm.uiGsmUsartFlag & GSM_OPEN_OR_CLOSE_KEEP_FLAGE))
000032  f8940604          LDRB     r0,[r4,#0x604]  ; mdGsm
000036  0680              LSLS     r0,r0,#26
000038  d41b              BMI      |L9.114|
;;;124    	{
;;;125    		mdGsm.uiGsmOpenOrCloseKeepTime--;
00003a  f8b4060a          LDRH     r0,[r4,#0x60a]  ; mdGsm
00003e  1e40              SUBS     r0,r0,#1
000040  0400              LSLS     r0,r0,#16
000042  0c00              LSRS     r0,r0,#16
000044  f8a4060a          STRH     r0,[r4,#0x60a]
;;;126    		/*开关机保持时间到*/
;;;127    		if(mdGsm.uiGsmOpenOrCloseKeepTime == 0)
000048  d113              BNE      |L9.114|
;;;128    		{
;;;129    			GsmGpioControl(GSM_ON_PORT,GSM_ON,0);
00004a  2200              MOVS     r2,#0
00004c  4629              MOV      r1,r5
00004e  4630              MOV      r0,r6
000050  f7fffffe          BL       GsmGpioControl
;;;130    			mdGsm.uiGsmUsartFlag |= GSM_OPEN_OR_CLOSE_KEEP_FLAGE;
000054  f8b40604          LDRH     r0,[r4,#0x604]  ; mdGsm
000058  f0400020          ORR      r0,r0,#0x20
00005c  f8a40604          STRH     r0,[r4,#0x604]
;;;131    			/*保持时间不不在变动*/
;;;132    			mdGsm.sGsmComInfo.WorkFlage &= ~GSM_RECV_NEW_DATA;
000060  f8940602          LDRB     r0,[r4,#0x602]  ; mdGsm
000064  f0200040          BIC      r0,r0,#0x40
000068  f8840602          STRB     r0,[r4,#0x602]
;;;133    			/*清楚接受到新数据*/
;;;134    			mdGsm.uiGsmOpenOrCloseKeepTime = 0;		
00006c  2000              MOVS     r0,#0
00006e  f8a4060a          STRH     r0,[r4,#0x60a]
                  |L9.114|
;;;135    		}
;;;136    		
;;;137    	}
;;;138    	/*最后一段时间检测本次关机是否成功，如果不成功则返回错误，
;;;139    	*/
;;;140    	/*开机测试*/
;;;141    	if(mdGsm.uiGsmUsartFlag & GSM_MODE_TEST)
000072  f8b40604          LDRH     r0,[r4,#0x604]  ; mdGsm
000076  05c0              LSLS     r0,r0,#23
000078  d518              BPL      |L9.172|
;;;142    	{
;;;143    		if(mdGsm.uiGsmOpenOrCloseKeepTime <= 5)
00007a  f8b4060a          LDRH     r0,[r4,#0x60a]  ; mdGsm
00007e  2805              CMP      r0,#5
000080  d814              BHI      |L9.172|
;;;144    		{
;;;145    			if(SetGsmAte(0))
000082  2000              MOVS     r0,#0
000084  f7fffffe          BL       SetGsmAte
000088  b138              CBZ      r0,|L9.154|
;;;146    			{
;;;147    				mdGsm.uiGsmUsartFlag &=~GSM_OPEN_OR_CLOSE_STATE;
00008a  f8b40604          LDRH     r0,[r4,#0x604]  ; mdGsm
;;;148    				/*清楚模块正在开机和关机过程中*/
;;;149    				mdGsm.uiGsmUsartFlag &=~GSM_MODE_TEST;
00008e  f4207088          BIC      r0,r0,#0x110
000092  f8a40604          STRH     r0,[r4,#0x604]
;;;150    				return 1;
000096  2001              MOVS     r0,#1
;;;151    			}
;;;152    			if(mdGsm.uiGsmOpenOrCloseKeepTime == 0)
;;;153    			{
;;;154    				mdGsm.uiGsmUsartFlag &=~GSM_MODE_TEST;/*清楚模块正在验证*/
;;;155    			}
;;;156    		}
;;;157    	}
;;;158    	
;;;159    	return 0;	/*失败*/
;;;160    }
000098  bd70              POP      {r4-r6,pc}
                  |L9.154|
00009a  f8b4060a          LDRH     r0,[r4,#0x60a]        ;152  ; mdGsm
00009e  b928              CBNZ     r0,|L9.172|
0000a0  f8b40604          LDRH     r0,[r4,#0x604]        ;154  ; mdGsm
0000a4  f4207080          BIC      r0,r0,#0x100          ;154
0000a8  f8a40604          STRH     r0,[r4,#0x604]        ;154
                  |L9.172|
0000ac  2000              MOVS     r0,#0                 ;159
0000ae  bd70              POP      {r4-r6,pc}
;;;161    /*gsm模块连接处理，主要负责连接到网络*/
                          ENDP

                  |L9.176|
                          DCD      ||.bss||
                  |L9.180|
                          DCD      0x40010800

                          AREA ||i.GsmParmInit||, CODE, READONLY, ALIGN=1

                  GsmParmInit PROC
;;;939    /*gsm模块参数初始化*/
;;;940    uint16_t GsmParmInit()
000000  4770              BX       lr
;;;941    {
;;;942    	
;;;943    }
;;;944    /*gsm模块io口高低电平控制*/
                          ENDP


                          AREA ||i.GsmPortInit||, CODE, READONLY, ALIGN=2

                  GsmPortInit PROC
;;;956    /*gsm模块端口初始化*/
;;;957    uint16_t GsmPortInit()
000000  b5f8              PUSH     {r3-r7,lr}
;;;958    {
;;;959    	GPIO_InitTypeDef GPIO_InitStructure;
;;;960    	
;;;961    	GPIO_InitStructure.GPIO_Pin = GSM_ON;
000002  f44f7480          MOV      r4,#0x100
000006  f8ad4000          STRH     r4,[sp,#0]
;;;962    	GPIO_InitStructure.GPIO_Mode = GPIO_Mode_Out_PP;
00000a  2510              MOVS     r5,#0x10
;;;963    	GPIO_InitStructure.GPIO_Speed = GPIO_Speed_50MHz;
;;;964    	GPIO_Init(GSM_ON_PORT,&GPIO_InitStructure);
00000c  4f10              LDR      r7,|L11.80|
00000e  f88d5003          STRB     r5,[sp,#3]            ;962
000012  2603              MOVS     r6,#3                 ;963
000014  f88d6002          STRB     r6,[sp,#2]            ;963
000018  4669              MOV      r1,sp
00001a  4638              MOV      r0,r7
00001c  f7fffffe          BL       GPIO_Init
;;;965    	
;;;966    	GsmGpioControl(GSM_ON_PORT,GSM_ON,1);
000020  2201              MOVS     r2,#1
000022  4621              MOV      r1,r4
000024  4638              MOV      r0,r7
000026  f7fffffe          BL       GsmGpioControl
;;;967    	
;;;968    	GPIO_InitStructure.GPIO_Pin = GSM_REST;
00002a  2080              MOVS     r0,#0x80
00002c  f8ad0000          STRH     r0,[sp,#0]
;;;969    	GPIO_InitStructure.GPIO_Mode=GPIO_Mode_Out_PP;		 
;;;970    	GPIO_InitStructure.GPIO_Speed=GPIO_Speed_50MHz;
;;;971    	GPIO_Init(GSM_REST_PORT,&GPIO_InitStructure);
000030  4c08              LDR      r4,|L11.84|
000032  f88d5003          STRB     r5,[sp,#3]            ;969
000036  f88d6002          STRB     r6,[sp,#2]            ;970
00003a  4669              MOV      r1,sp
00003c  4620              MOV      r0,r4
00003e  f7fffffe          BL       GPIO_Init
;;;972    	
;;;973    	GsmGpioControl(GSM_REST_PORT,GSM_REST,0);
000042  2200              MOVS     r2,#0
000044  2180              MOVS     r1,#0x80
000046  4620              MOV      r0,r4
000048  f7fffffe          BL       GsmGpioControl
;;;974    	
;;;975    }
00004c  bdf8              POP      {r3-r7,pc}
;;;976    uint16_t SysGsmInit()
                          ENDP

00004e  0000              DCW      0x0000
                  |L11.80|
                          DCD      0x40010800
                  |L11.84|
                          DCD      0x40011400

                          AREA ||i.GsmRecvCmdDel||, CODE, READONLY, ALIGN=2

                  GsmRecvCmdDel PROC
;;;919    
;;;920    uint16_t GsmRecvCmdDel(uint16_t arg1,uint16_t arg2)
000000  490c              LDR      r1,|L12.52|
;;;921    {
;;;922    	mdGsm.sGsmComInfo.WorkFlage |= RECV_IS_ING;	/*正在接受*/
000002  f8912602          LDRB     r2,[r1,#0x602]  ; mdGsm
000006  f0420202          ORR      r2,r2,#2
00000a  f8812602          STRB     r2,[r1,#0x602]
;;;923    	
;;;924    	mdGsm.sGsmComInfo.RecvMessage[mdGsm.sGsmComInfo.RecvCount] = arg1;
00000e  f8912600          LDRB     r2,[r1,#0x600]  ; mdGsm
000012  5488              STRB     r0,[r1,r2]
;;;925    	
;;;926    	mdGsm.sGsmComInfo.RecvCount++;
000014  f8910600          LDRB     r0,[r1,#0x600]  ; mdGsm
000018  1c40              ADDS     r0,r0,#1
00001a  b2c0              UXTB     r0,r0
00001c  f8810600          STRB     r0,[r1,#0x600]
;;;927    	
;;;928    	if(mdGsm.sGsmComInfo.RecvCount > 2)
000020  2802              CMP      r0,#2
000022  d905              BLS      |L12.48|
;;;929    	{
;;;930    		mdGsm.sGsmComInfo.WorkFlage |= GSM_RECV_NEW_DATA;
000024  f8910602          LDRB     r0,[r1,#0x602]  ; mdGsm
000028  f0400040          ORR      r0,r0,#0x40
00002c  f8810602          STRB     r0,[r1,#0x602]
                  |L12.48|
;;;931    	}
;;;932    	if(mdGsm.sGsmComInfo.RecvCount > GSM_RECV_BUFF_LEN)
;;;933    	{
;;;934    		/*未处理*/
;;;935    		mdGsm.sGsmComInfo.RecvCount = 0;
;;;936    	}
;;;937    	return 1;
000030  2001              MOVS     r0,#1
;;;938    }
000032  4770              BX       lr
;;;939    /*gsm模块参数初始化*/
                          ENDP

                  |L12.52|
                          DCD      ||.bss||

                          AREA ||i.GsmRspCheckOK||, CODE, READONLY, ALIGN=2

                  GsmRspCheckOK PROC
;;;26     /*检查模块回复中的ok*/
;;;27     uint8_t GsmRspCheckOK()
000000  4909              LDR      r1,|L13.40|
;;;28     {
;;;29     	uint16_t uiLoop =0;
000002  2000              MOVS     r0,#0
;;;30     	
;;;31     	for(uiLoop = 0;uiLoop < GSM_RECV_BUFF_LEN; uiLoop++)
000004  f44f6280          MOV      r2,#0x400
                  |L13.8|
;;;32     	{
;;;33     			if((mdGsm.sGsmComInfo.RecvMessage[ uiLoop ]=='O')&&
000008  5c0b              LDRB     r3,[r1,r0]
00000a  2b4f              CMP      r3,#0x4f
00000c  d103              BNE      |L13.22|
;;;34     					(mdGsm.sGsmComInfo.RecvMessage[ uiLoop + 1]=='K'))
00000e  180b              ADDS     r3,r1,r0
000010  785b              LDRB     r3,[r3,#1]
000012  2b4b              CMP      r3,#0x4b
000014  d005              BEQ      |L13.34|
                  |L13.22|
000016  1c40              ADDS     r0,r0,#1
000018  b280              UXTH     r0,r0                 ;31
00001a  4290              CMP      r0,r2                 ;31
00001c  d3f4              BCC      |L13.8|
;;;35     			{
;;;36     				return 1;											//返回完成
;;;37     			}
;;;38     	}
;;;39     	return 0;	/*没有检测到*/
00001e  2000              MOVS     r0,#0
;;;40     }
000020  4770              BX       lr
                  |L13.34|
000022  2001              MOVS     r0,#1                 ;36
000024  4770              BX       lr
;;;41     /*准备回显需要发送的命令*/
                          ENDP

000026  0000              DCW      0x0000
                  |L13.40|
                          DCD      ||.bss||

                          AREA ||i.ReadGsmCGMR||, CODE, READONLY, ALIGN=2

                  ReadGsmCGMR PROC
;;;216    /*读取模块版本号码*/
;;;217    uint8_t ReadGsmCGMR()
000000  b570              PUSH     {r4-r6,lr}
;;;218    {
;;;219    	uint16_t uiLoop =0;
;;;220    	uint8_t flage =0;
;;;221    	if(!(mdGsm.uiGsmUsartFlag & GSM_SEND_ING))
000002  4c33              LDR      r4,|L14.208|
000004  2500              MOVS     r5,#0                 ;219
000006  f8b41604          LDRH     r1,[r4,#0x604]  ; mdGsm
00000a  0608              LSLS     r0,r1,#24
00000c  d45d              BMI      |L14.202|
;;;222    	{
;;;223    		if(mdGsm.uiGsmRepetWaitTimes == 0)
00000e  f8b4060e          LDRH     r0,[r4,#0x60e]  ; mdGsm
000012  2600              MOVS     r6,#0
000014  b150              CBZ      r0,|L14.44|
000016  1e40              SUBS     r0,r0,#1
;;;224    		{
;;;225    			mdGsm.uiGsmRepetWaitTimes = GSM_REPET_WAIT_TIME;
;;;226    			mdGsm.uiGsmUsartFlag |= GSM_SEND_ING;
;;;227    			ReadGsmCGMRStr();
;;;228    			mdGsm.sGsmComInfo.RecvCount = 0;
;;;229    			CleanGsmRsp();	
;;;230    					
;;;231    			SendGsmControlCmd((char *)mdGsm.sGsmComInfo.SendMessage,
;;;232    												mdGsm.sGsmComInfo.SendCount);
;;;233    		}
;;;234    		else
;;;235    		{
;;;236    			mdGsm.uiGsmRepetWaitTimes--;
000018  f8a4060e          STRH     r0,[r4,#0x60e]
                  |L14.28|
;;;237    		}
;;;238    		/*接受到新数据*/
;;;239    		
;;;240    		if(mdGsm.sGsmComInfo.WorkFlage & GSM_RECV_NEW_DATA)
00001c  f8941602          LDRB     r1,[r4,#0x602]  ; mdGsm
000020  0648              LSLS     r0,r1,#25
000022  d54c              BPL      |L14.190|
                  |L14.36|
;;;241    		{
;;;242    			for(uiLoop = 0;uiLoop < GSM_RECV_BUFF_LEN; uiLoop++)
;;;243    			{
;;;244    				if((mdGsm.sGsmComInfo.RecvMessage[uiLoop] == 'M') && 
000024  5d60              LDRB     r0,[r4,r5]
000026  284d              CMP      r0,#0x4d
000028  d013              BEQ      |L14.82|
00002a  e032              B        |L14.146|
                  |L14.44|
00002c  200a              MOVS     r0,#0xa               ;225
00002e  f8a4060e          STRH     r0,[r4,#0x60e]        ;225
000032  f0410080          ORR      r0,r1,#0x80           ;226
000036  f8a40604          STRH     r0,[r4,#0x604]        ;226
00003a  f7fffffe          BL       ReadGsmCGMRStr
00003e  f8846600          STRB     r6,[r4,#0x600]        ;228
000042  f7fffffe          BL       CleanGsmRsp
000046  f8941601          LDRB     r1,[r4,#0x601]        ;231  ; mdGsm
00004a  4822              LDR      r0,|L14.212|
00004c  f7fffffe          BL       SendGsmControlCmd
000050  e7e4              B        |L14.28|
                  |L14.82|
;;;245    					(mdGsm.sGsmComInfo.RecvMessage[uiLoop + 1]=='E') && 
000052  1960              ADDS     r0,r4,r5
000054  7842              LDRB     r2,[r0,#1]
000056  2a45              CMP      r2,#0x45
000058  d002              BEQ      |L14.96|
;;;246    					(mdGsm.sGsmComInfo.RecvMessage[uiLoop+2] == '3') && 
;;;247    					(mdGsm.sGsmComInfo.RecvMessage[uiLoop + 3]=='0') &&
;;;248    					(mdGsm.sGsmComInfo.RecvMessage[uiLoop+4] == '0') && 
;;;249    					(mdGsm.sGsmComInfo.RecvMessage[uiLoop + 5]=='0'))
;;;250    				{
;;;251    					/*清楚模块正在发送过程中*/
;;;252    					mdGsm.uiGsmUsartFlag &=~GSM_SEND_ING;
;;;253    					mdGsm.sGsmComInfo.WorkFlage &=~GSM_RECV_NEW_DATA;
;;;254    					/*清楚接受到新数据*/
;;;255    					mdGsm.sGsmComInfo.RecvCount =0;
;;;256    					mdGsm.uiGsmRepetWaitTimes = 0;
;;;257    					return 1;
;;;258    				}
;;;259    				
;;;260    				if((mdGsm.sGsmComInfo.RecvMessage[uiLoop] == 'M') && 
;;;261    					(mdGsm.sGsmComInfo.RecvMessage[uiLoop + 1]=='G') && 
00005a  2a47              CMP      r2,#0x47
00005c  d00d              BEQ      |L14.122|
00005e  e018              B        |L14.146|
                  |L14.96|
000060  7882              LDRB     r2,[r0,#2]            ;246
000062  2a33              CMP      r2,#0x33              ;246
000064  d115              BNE      |L14.146|
000066  78c2              LDRB     r2,[r0,#3]            ;247
000068  2a30              CMP      r2,#0x30              ;247
00006a  d112              BNE      |L14.146|
00006c  7902              LDRB     r2,[r0,#4]            ;248
00006e  2a30              CMP      r2,#0x30              ;248
000070  d10f              BNE      |L14.146|
000072  7940              LDRB     r0,[r0,#5]            ;249
000074  2830              CMP      r0,#0x30              ;249
000076  d012              BEQ      |L14.158|
000078  e00b              B        |L14.146|
                  |L14.122|
;;;262    					(mdGsm.sGsmComInfo.RecvMessage[uiLoop+2] == '2') && 
00007a  7882              LDRB     r2,[r0,#2]
00007c  2a32              CMP      r2,#0x32
00007e  d108              BNE      |L14.146|
;;;263    					(mdGsm.sGsmComInfo.RecvMessage[uiLoop + 3]=='6') &&
000080  78c2              LDRB     r2,[r0,#3]
000082  2a36              CMP      r2,#0x36
000084  d105              BNE      |L14.146|
;;;264    					(mdGsm.sGsmComInfo.RecvMessage[uiLoop+4] == '3') && 
000086  7902              LDRB     r2,[r0,#4]
000088  2a33              CMP      r2,#0x33
00008a  d102              BNE      |L14.146|
;;;265    					(mdGsm.sGsmComInfo.RecvMessage[uiLoop + 5]=='9'))
00008c  7940              LDRB     r0,[r0,#5]
00008e  2839              CMP      r0,#0x39
000090  d005              BEQ      |L14.158|
                  |L14.146|
000092  1c6d              ADDS     r5,r5,#1
000094  b2ad              UXTH     r5,r5                 ;242
000096  f5b56f80          CMP      r5,#0x400             ;242
00009a  d3c3              BCC      |L14.36|
00009c  e015              B        |L14.202|
                  |L14.158|
;;;266    				{
;;;267    					/*清楚模块正在发送过程中*/
;;;268    					mdGsm.uiGsmUsartFlag &=~GSM_SEND_ING;
00009e  f8b40604          LDRH     r0,[r4,#0x604]  ; mdGsm
0000a2  f0200080          BIC      r0,r0,#0x80
0000a6  f8a40604          STRH     r0,[r4,#0x604]
;;;269    					mdGsm.sGsmComInfo.WorkFlage &=~GSM_RECV_NEW_DATA;
0000aa  f0210040          BIC      r0,r1,#0x40
0000ae  f8840602          STRB     r0,[r4,#0x602]
;;;270    					/*清楚接受到新数据*/
;;;271    					mdGsm.sGsmComInfo.RecvCount = 0;
0000b2  f8846600          STRB     r6,[r4,#0x600]
;;;272    					mdGsm.uiGsmRepetWaitTimes = 0;
0000b6  f8a4660e          STRH     r6,[r4,#0x60e]
;;;273    					return 1;
0000ba  2001              MOVS     r0,#1
;;;274    				}
;;;275    			}
;;;276    			
;;;277    		}
;;;278    		else
;;;279    		{
;;;280    				mdGsm.uiGsmUsartFlag &= ~GSM_SEND_ING;/*命令重试*/	
;;;281    		}
;;;282    	}
;;;283    	return 0;
;;;284    }
0000bc  bd70              POP      {r4-r6,pc}
                  |L14.190|
0000be  f8b40604          LDRH     r0,[r4,#0x604]        ;280  ; mdGsm
0000c2  f0200080          BIC      r0,r0,#0x80           ;280
0000c6  f8a40604          STRH     r0,[r4,#0x604]        ;280
                  |L14.202|
0000ca  2000              MOVS     r0,#0                 ;283
0000cc  bd70              POP      {r4-r6,pc}
;;;285    /*读取IMEI准备字符串*/
                          ENDP

0000ce  0000              DCW      0x0000
                  |L14.208|
                          DCD      ||.bss||
                  |L14.212|
                          DCD      ||.bss||+0x400

                          AREA ||i.ReadGsmCGMRStr||, CODE, READONLY, ALIGN=2

                  ReadGsmCGMRStr PROC
;;;201    /*读取模块版本号码,准备数据*/
;;;202    uint8_t ReadGsmCGMRStr()
000000  b510              PUSH     {r4,lr}
;;;203    {
;;;204    	memset(mdGsm.sGsmComInfo.SendMessage,0,GSM_SEND_BUF_LEN);
000002  f44f7100          MOV      r1,#0x200
000006  4811              LDR      r0,|L15.76|
000008  f7fffffe          BL       __aeabi_memclr
;;;205    	mdGsm.sGsmComInfo.SendMessage[0] = 'A';
00000c  4810              LDR      r0,|L15.80|
00000e  2141              MOVS     r1,#0x41
000010  f8801400          STRB     r1,[r0,#0x400]
;;;206    	mdGsm.sGsmComInfo.SendMessage[1] = 'T';
000014  2154              MOVS     r1,#0x54
000016  f8801401          STRB     r1,[r0,#0x401]
;;;207    	mdGsm.sGsmComInfo.SendMessage[2] = '+';
00001a  212b              MOVS     r1,#0x2b
00001c  f8801402          STRB     r1,[r0,#0x402]
;;;208    	mdGsm.sGsmComInfo.SendMessage[3] = 'C';
000020  2143              MOVS     r1,#0x43
000022  f8801403          STRB     r1,[r0,#0x403]
;;;209    	mdGsm.sGsmComInfo.SendMessage[4] = 'G';
000026  2147              MOVS     r1,#0x47
000028  f8801404          STRB     r1,[r0,#0x404]
;;;210    	mdGsm.sGsmComInfo.SendMessage[5] = 'M';
00002c  214d              MOVS     r1,#0x4d
00002e  f8801405          STRB     r1,[r0,#0x405]
;;;211    	mdGsm.sGsmComInfo.SendMessage[6] = 'R';
000032  2152              MOVS     r1,#0x52
000034  f8801406          STRB     r1,[r0,#0x406]
;;;212    	mdGsm.sGsmComInfo.SendMessage[7] = '\r';
000038  210d              MOVS     r1,#0xd
00003a  f8801407          STRB     r1,[r0,#0x407]
;;;213    	mdGsm.sGsmComInfo.SendMessage[8] = '\n';
00003e  210a              MOVS     r1,#0xa
000040  f8801408          STRB     r1,[r0,#0x408]
;;;214    	mdGsm.sGsmComInfo.SendCount = 9;
000044  2109              MOVS     r1,#9
000046  f8801601          STRB     r1,[r0,#0x601]
;;;215    }
00004a  bd10              POP      {r4,pc}
;;;216    /*读取模块版本号码*/
                          ENDP

                  |L15.76|
                          DCD      ||.bss||+0x400
                  |L15.80|
                          DCD      ||.bss||

                          AREA ||i.ReadGsmCGSN||, CODE, READONLY, ALIGN=2

                  ReadGsmCGSN PROC
;;;301    /*读取模块IMEI*/
;;;302    uint8_t ReadGsmCGSN()
000000  b570              PUSH     {r4-r6,lr}
;;;303    {
;;;304    	uint16_t uiLoop =0;
;;;305    	uint8_t flage =0;
;;;306    	if(!(mdGsm.uiGsmUsartFlag & GSM_SEND_ING))
000002  4c1f              LDR      r4,|L16.128|
000004  f8b41604          LDRH     r1,[r4,#0x604]  ; mdGsm
000008  0608              LSLS     r0,r1,#24
00000a  d437              BMI      |L16.124|
;;;307    	{
;;;308    		if(mdGsm.uiGsmRepetWaitTimes == 0)
00000c  f8b4060e          LDRH     r0,[r4,#0x60e]  ; mdGsm
000010  2500              MOVS     r5,#0
000012  b1d0              CBZ      r0,|L16.74|
000014  1e40              SUBS     r0,r0,#1
;;;309    		{
;;;310    			mdGsm.uiGsmRepetWaitTimes = GSM_REPET_WAIT_TIME;
;;;311    			mdGsm.uiGsmUsartFlag |= GSM_SEND_ING;
;;;312    			ReadGsmCGSNStr();
;;;313    			mdGsm.sGsmComInfo.RecvCount = 0;
;;;314    			CleanGsmRsp();	
;;;315    					
;;;316    			SendGsmControlCmd((char *)mdGsm.sGsmComInfo.SendMessage,
;;;317    												mdGsm.sGsmComInfo.SendCount);
;;;318    		}
;;;319    		else
;;;320    		{
;;;321    			mdGsm.uiGsmRepetWaitTimes--;
000016  f8a4060e          STRH     r0,[r4,#0x60e]
;;;322    		}
;;;323    		/*接受到新数据*/
;;;324    		
;;;325    		if(mdGsm.sGsmComInfo.WorkFlage & GSM_RECV_NEW_DATA)
00001a  bf00              NOP      
                  |L16.28|
00001c  f8940602          LDRB     r0,[r4,#0x602]  ; mdGsm
000020  0640              LSLS     r0,r0,#25
000022  d525              BPL      |L16.112|
;;;326    		{
;;;327    			if(GsmRspCheckOK())
000024  f7fffffe          BL       GsmRspCheckOK
000028  b340              CBZ      r0,|L16.124|
;;;328    			{
;;;329    				mdGsm.sGsmComInfo.WorkFlage &= ~GSM_RECV_NEW_DATA;
00002a  f8940602          LDRB     r0,[r4,#0x602]  ; mdGsm
00002e  f0200040          BIC      r0,r0,#0x40
000032  f8840602          STRB     r0,[r4,#0x602]
;;;330    				mdGsm.uiGsmUsartFlag &= ~GSM_SEND_ING;
000036  f8b40604          LDRH     r0,[r4,#0x604]  ; mdGsm
00003a  f0200080          BIC      r0,r0,#0x80
00003e  f8a40604          STRH     r0,[r4,#0x604]
;;;331    				mdGsm.uiGsmRepetWaitTimes =0;
000042  f8a4560e          STRH     r5,[r4,#0x60e]
;;;332    				return 1;
000046  2001              MOVS     r0,#1
;;;333    			}
;;;334    		}
;;;335    		else
;;;336    		{
;;;337    				mdGsm.uiGsmUsartFlag &= ~GSM_SEND_ING;/*命令重试*/	
;;;338    		}
;;;339    	}
;;;340    	return 0;
;;;341    }
000048  bd70              POP      {r4-r6,pc}
                  |L16.74|
00004a  200a              MOVS     r0,#0xa               ;310
00004c  f8a4060e          STRH     r0,[r4,#0x60e]        ;310
000050  f0410080          ORR      r0,r1,#0x80           ;311
000054  f8a40604          STRH     r0,[r4,#0x604]        ;311
000058  f7fffffe          BL       ReadGsmCGSNStr
00005c  f8845600          STRB     r5,[r4,#0x600]        ;313
000060  f7fffffe          BL       CleanGsmRsp
000064  f8941601          LDRB     r1,[r4,#0x601]        ;316  ; mdGsm
000068  4806              LDR      r0,|L16.132|
00006a  f7fffffe          BL       SendGsmControlCmd
00006e  e7d5              B        |L16.28|
                  |L16.112|
000070  f8b40604          LDRH     r0,[r4,#0x604]        ;337  ; mdGsm
000074  f0200080          BIC      r0,r0,#0x80           ;337
000078  f8a40604          STRH     r0,[r4,#0x604]        ;337
                  |L16.124|
00007c  2000              MOVS     r0,#0                 ;340
00007e  bd70              POP      {r4-r6,pc}
;;;342    
                          ENDP

                  |L16.128|
                          DCD      ||.bss||
                  |L16.132|
                          DCD      ||.bss||+0x400

                          AREA ||i.ReadGsmCGSNStr||, CODE, READONLY, ALIGN=2

                  ReadGsmCGSNStr PROC
;;;285    /*读取IMEI准备字符串*/
;;;286    uint8_t ReadGsmCGSNStr()
000000  b510              PUSH     {r4,lr}
;;;287    {
;;;288    	memset(mdGsm.sGsmComInfo.SendMessage,0,GSM_SEND_BUF_LEN);
000002  f44f7100          MOV      r1,#0x200
000006  4811              LDR      r0,|L17.76|
000008  f7fffffe          BL       __aeabi_memclr
;;;289    	
;;;290    	mdGsm.sGsmComInfo.SendMessage[0]='A';
00000c  4810              LDR      r0,|L17.80|
00000e  2141              MOVS     r1,#0x41
000010  f8801400          STRB     r1,[r0,#0x400]
;;;291    	mdGsm.sGsmComInfo.SendMessage[1]='T';
000014  2154              MOVS     r1,#0x54
000016  f8801401          STRB     r1,[r0,#0x401]
;;;292    	mdGsm.sGsmComInfo.SendMessage[2]='+';
00001a  212b              MOVS     r1,#0x2b
00001c  f8801402          STRB     r1,[r0,#0x402]
;;;293    	mdGsm.sGsmComInfo.SendMessage[3]='C';
000020  2143              MOVS     r1,#0x43
000022  f8801403          STRB     r1,[r0,#0x403]
;;;294    	mdGsm.sGsmComInfo.SendMessage[4]='G';
000026  2147              MOVS     r1,#0x47
000028  f8801404          STRB     r1,[r0,#0x404]
;;;295    	mdGsm.sGsmComInfo.SendMessage[5]='S';
00002c  2153              MOVS     r1,#0x53
00002e  f8801405          STRB     r1,[r0,#0x405]
;;;296    	mdGsm.sGsmComInfo.SendMessage[6]='N';
000032  214e              MOVS     r1,#0x4e
000034  f8801406          STRB     r1,[r0,#0x406]
;;;297    	mdGsm.sGsmComInfo.SendMessage[7]='\r';
000038  210d              MOVS     r1,#0xd
00003a  f8801407          STRB     r1,[r0,#0x407]
;;;298    	mdGsm.sGsmComInfo.SendMessage[8]='\n';
00003e  210a              MOVS     r1,#0xa
000040  f8801408          STRB     r1,[r0,#0x408]
;;;299    	mdGsm.sGsmComInfo.SendCount =9;
000044  2109              MOVS     r1,#9
000046  f8801601          STRB     r1,[r0,#0x601]
;;;300    }
00004a  bd10              POP      {r4,pc}
;;;301    /*读取模块IMEI*/
                          ENDP

                  |L17.76|
                          DCD      ||.bss||+0x400
                  |L17.80|
                          DCD      ||.bss||

                          AREA ||i.ReadGsmCOPPSStr||, CODE, READONLY, ALIGN=2

                  ReadGsmCOPPSStr PROC
;;;651    /*读取运营商命令*/
;;;652    uint16_t ReadGsmCOPPSStr()
000000  b510              PUSH     {r4,lr}
;;;653    {
;;;654    	memset(mdGsm.sGsmComInfo.SendMessage,0,GSM_SEND_BUF_LEN);
000002  f44f7100          MOV      r1,#0x200
000006  4812              LDR      r0,|L18.80|
000008  f7fffffe          BL       __aeabi_memclr
;;;655    	
;;;656    	mdGsm.sGsmComInfo.SendMessage[0]='A';
00000c  4811              LDR      r0,|L18.84|
00000e  2141              MOVS     r1,#0x41
000010  f8801400          STRB     r1,[r0,#0x400]
;;;657    	mdGsm.sGsmComInfo.SendMessage[1]='T';
000014  2154              MOVS     r1,#0x54
000016  f8801401          STRB     r1,[r0,#0x401]
;;;658    	mdGsm.sGsmComInfo.SendMessage[2]='+';
00001a  212b              MOVS     r1,#0x2b
00001c  f8801402          STRB     r1,[r0,#0x402]
;;;659    	mdGsm.sGsmComInfo.SendMessage[3]='C';
000020  2143              MOVS     r1,#0x43
000022  f8801403          STRB     r1,[r0,#0x403]
;;;660    	mdGsm.sGsmComInfo.SendMessage[4]='O';
000026  214f              MOVS     r1,#0x4f
000028  f8801404          STRB     r1,[r0,#0x404]
;;;661    	mdGsm.sGsmComInfo.SendMessage[5]='P';
00002c  2150              MOVS     r1,#0x50
00002e  f8801405          STRB     r1,[r0,#0x405]
;;;662    	mdGsm.sGsmComInfo.SendMessage[6]='S';
000032  2153              MOVS     r1,#0x53
000034  f8801406          STRB     r1,[r0,#0x406]
;;;663    	mdGsm.sGsmComInfo.SendMessage[7]='?';
000038  213f              MOVS     r1,#0x3f
00003a  f8801407          STRB     r1,[r0,#0x407]
;;;664    	mdGsm.sGsmComInfo.SendMessage[8]='\r';
00003e  210d              MOVS     r1,#0xd
000040  f8801408          STRB     r1,[r0,#0x408]
;;;665    	mdGsm.sGsmComInfo.SendMessage[9]='\n';
000044  210a              MOVS     r1,#0xa
000046  f8801409          STRB     r1,[r0,#0x409]
;;;666    	
;;;667    	mdGsm.sGsmComInfo.SendCount = 10;
00004a  f8801601          STRB     r1,[r0,#0x601]
;;;668    	
;;;669    }
00004e  bd10              POP      {r4,pc}
;;;670    /*读取运营商*/
                          ENDP

                  |L18.80|
                          DCD      ||.bss||+0x400
                  |L18.84|
                          DCD      ||.bss||

                          AREA ||i.ReadGsmCOPS||, CODE, READONLY, ALIGN=2

                  ReadGsmCOPS PROC
;;;508    /*读取网络注册格式*/
;;;509    uint16_t ReadGsmCOPS()
000000  b570              PUSH     {r4-r6,lr}
;;;510    {
;;;511    	uint16_t uiLoop =0;
;;;512    	uint8_t flage =0;
;;;513    	if(!(mdGsm.uiGsmUsartFlag & GSM_SEND_ING))
000002  4c1f              LDR      r4,|L19.128|
000004  f8b41604          LDRH     r1,[r4,#0x604]  ; mdGsm
000008  0608              LSLS     r0,r1,#24
00000a  d437              BMI      |L19.124|
;;;514    	{
;;;515    		if(mdGsm.uiGsmRepetWaitTimes == 0)
00000c  f8b4060e          LDRH     r0,[r4,#0x60e]  ; mdGsm
000010  2500              MOVS     r5,#0
000012  b1d0              CBZ      r0,|L19.74|
000014  1e40              SUBS     r0,r0,#1
;;;516    		{
;;;517    			mdGsm.uiGsmRepetWaitTimes = GSM_REPET_WAIT_TIME;
;;;518    			mdGsm.uiGsmUsartFlag |= GSM_SEND_ING;
;;;519    			ReadGsmCOPSStr();
;;;520    			mdGsm.sGsmComInfo.RecvCount = 0;
;;;521    			CleanGsmRsp();	
;;;522    					
;;;523    			SendGsmControlCmd((char *)mdGsm.sGsmComInfo.SendMessage,
;;;524    												mdGsm.sGsmComInfo.SendCount);
;;;525    		}
;;;526    		else
;;;527    		{
;;;528    			mdGsm.uiGsmRepetWaitTimes--;
000016  f8a4060e          STRH     r0,[r4,#0x60e]
;;;529    		}
;;;530    		/*接受到新数据*/
;;;531    		
;;;532    		if(mdGsm.sGsmComInfo.WorkFlage & GSM_RECV_NEW_DATA)
00001a  bf00              NOP      
                  |L19.28|
00001c  f8940602          LDRB     r0,[r4,#0x602]  ; mdGsm
000020  0640              LSLS     r0,r0,#25
000022  d525              BPL      |L19.112|
;;;533    		{
;;;534    				if(GsmRspCheckOK())
000024  f7fffffe          BL       GsmRspCheckOK
000028  b340              CBZ      r0,|L19.124|
;;;535    				{
;;;536    					mdGsm.uiGsmRepetWaitTimes = 0;
00002a  f8a4560e          STRH     r5,[r4,#0x60e]
;;;537    					mdGsm.uiGsmUsartFlag &=~GSM_SEND_ING;	/*清楚正在发送数据*/
00002e  f8b40604          LDRH     r0,[r4,#0x604]  ; mdGsm
000032  f0200080          BIC      r0,r0,#0x80
000036  f8a40604          STRH     r0,[r4,#0x604]
;;;538    					mdGsm.sGsmComInfo.WorkFlage &=~GSM_RECV_NEW_DATA;/*清楚接受到新数据*/
00003a  f8940602          LDRB     r0,[r4,#0x602]  ; mdGsm
00003e  f0200040          BIC      r0,r0,#0x40
000042  f8840602          STRB     r0,[r4,#0x602]
;;;539    				
;;;540    					return 1;
000046  2001              MOVS     r0,#1
;;;541    				}					
;;;542    		}
;;;543    		else
;;;544    		{
;;;545    				mdGsm.uiGsmUsartFlag &= ~GSM_SEND_ING;/*命令重试*/	
;;;546    		}
;;;547    	}
;;;548    	return 0;
;;;549    }
000048  bd70              POP      {r4-r6,pc}
                  |L19.74|
00004a  200a              MOVS     r0,#0xa               ;517
00004c  f8a4060e          STRH     r0,[r4,#0x60e]        ;517
000050  f0410080          ORR      r0,r1,#0x80           ;518
000054  f8a40604          STRH     r0,[r4,#0x604]        ;518
000058  f7fffffe          BL       ReadGsmCOPSStr
00005c  f8845600          STRB     r5,[r4,#0x600]        ;520
000060  f7fffffe          BL       CleanGsmRsp
000064  f8941601          LDRB     r1,[r4,#0x601]        ;523  ; mdGsm
000068  4806              LDR      r0,|L19.132|
00006a  f7fffffe          BL       SendGsmControlCmd
00006e  e7d5              B        |L19.28|
                  |L19.112|
000070  f8b40604          LDRH     r0,[r4,#0x604]        ;545  ; mdGsm
000074  f0200080          BIC      r0,r0,#0x80           ;545
000078  f8a40604          STRH     r0,[r4,#0x604]        ;545
                  |L19.124|
00007c  2000              MOVS     r0,#0                 ;548
00007e  bd70              POP      {r4-r6,pc}
;;;550    /*读取信号量强度命令*/
                          ENDP

                  |L19.128|
                          DCD      ||.bss||
                  |L19.132|
                          DCD      ||.bss||+0x400

                          AREA ||i.ReadGsmCOPSS||, CODE, READONLY, ALIGN=2

                  ReadGsmCOPSS PROC
;;;670    /*读取运营商*/
;;;671    uint16_t ReadGsmCOPSS()
000000  b570              PUSH     {r4-r6,lr}
;;;672    {
;;;673    	uint16_t uiLoop =0;
;;;674    	uint8_t flage =0;
;;;675    	
;;;676    	if(!(mdGsm.uiGsmUsartFlag & GSM_SEND_ING))
000002  4c2d              LDR      r4,|L20.184|
000004  2500              MOVS     r5,#0                 ;673
000006  f8b41604          LDRH     r1,[r4,#0x604]  ; mdGsm
00000a  0608              LSLS     r0,r1,#24
00000c  d452              BMI      |L20.180|
;;;677    	{
;;;678    		if(mdGsm.uiGsmRepetWaitTimes == 0)
00000e  f8b4060e          LDRH     r0,[r4,#0x60e]  ; mdGsm
000012  2600              MOVS     r6,#0
000014  b160              CBZ      r0,|L20.48|
000016  1e40              SUBS     r0,r0,#1
;;;679    		{
;;;680    			mdGsm.uiGsmRepetWaitTimes = GSM_REPET_WAIT_TIME;
;;;681    			mdGsm.uiGsmUsartFlag |= GSM_SEND_ING;
;;;682    			ReadGsmCOPPSStr();
;;;683    			mdGsm.sGsmComInfo.RecvCount = 0;
;;;684    			CleanGsmRsp();	
;;;685    					
;;;686    			SendGsmControlCmd((char *)mdGsm.sGsmComInfo.SendMessage,
;;;687    												mdGsm.sGsmComInfo.SendCount);
;;;688    		}
;;;689    		else
;;;690    		{
;;;691    			mdGsm.uiGsmRepetWaitTimes--;
000018  f8a4060e          STRH     r0,[r4,#0x60e]
                  |L20.28|
;;;692    		}
;;;693    		/*接受到新数据*/
;;;694    		
;;;695    		if(mdGsm.sGsmComInfo.WorkFlage & GSM_RECV_NEW_DATA)
00001c  f8941602          LDRB     r1,[r4,#0x602]  ; mdGsm
000020  0648              LSLS     r0,r1,#25
000022  d541              BPL      |L20.168|
;;;696    		{
;;;697    				for(uiLoop = 0;uiLoop < GSM_RECV_BUFF_LEN;uiLoop++)
000024  f44f6280          MOV      r2,#0x400
                  |L20.40|
;;;698    				{
;;;699    							if((mdGsm.sGsmComInfo.RecvMessage[uiLoop]=='4') && 
000028  5d60              LDRB     r0,[r4,r5]
00002a  2834              CMP      r0,#0x34
00002c  d013              BEQ      |L20.86|
00002e  e021              B        |L20.116|
                  |L20.48|
000030  200a              MOVS     r0,#0xa               ;680
000032  f8a4060e          STRH     r0,[r4,#0x60e]        ;680
000036  f0410080          ORR      r0,r1,#0x80           ;681
00003a  f8a40604          STRH     r0,[r4,#0x604]        ;681
00003e  f7fffffe          BL       ReadGsmCOPPSStr
000042  f8846600          STRB     r6,[r4,#0x600]        ;683
000046  f7fffffe          BL       CleanGsmRsp
00004a  f8941601          LDRB     r1,[r4,#0x601]        ;686  ; mdGsm
00004e  481b              LDR      r0,|L20.188|
000050  f7fffffe          BL       SendGsmControlCmd
000054  e7e2              B        |L20.28|
                  |L20.86|
;;;700    								(mdGsm.sGsmComInfo.RecvMessage[uiLoop+1]=='6') &&
000056  1960              ADDS     r0,r4,r5
000058  7843              LDRB     r3,[r0,#1]
00005a  2b36              CMP      r3,#0x36
00005c  d10a              BNE      |L20.116|
;;;701    								(mdGsm.sGsmComInfo.RecvMessage[uiLoop+2]=='0') &&
00005e  7883              LDRB     r3,[r0,#2]
000060  2b30              CMP      r3,#0x30
000062  d107              BNE      |L20.116|
;;;702    								(mdGsm.sGsmComInfo.RecvMessage[uiLoop+3]=='0') &&
000064  78c3              LDRB     r3,[r0,#3]
000066  2b30              CMP      r3,#0x30
000068  d104              BNE      |L20.116|
;;;703    								(mdGsm.sGsmComInfo.RecvMessage[uiLoop+4]=='0'))
00006a  7900              LDRB     r0,[r0,#4]
00006c  2830              CMP      r0,#0x30
00006e  d006              BEQ      |L20.126|
;;;704    								{	
;;;705    									/*中国移动*/
;;;706    									mdGsm.uiOperator = GSM_OPERATOR_CHINA_MOBILE;
;;;707    									mdGsm.uiGsmRepetWaitTimes = 0;
;;;708    									mdGsm.uiGsmUsartFlag &=~GSM_SEND_ING;	/*清楚正在发送数据*/
;;;709    									mdGsm.sGsmComInfo.WorkFlage &=~GSM_RECV_NEW_DATA;/*清楚接受到新数据*/
;;;710    									
;;;711    									return 1;
;;;712    								}
;;;713    								
;;;714    							if((mdGsm.sGsmComInfo.RecvMessage[uiLoop]=='4') && 
;;;715    								(mdGsm.sGsmComInfo.RecvMessage[uiLoop+1]=='6') &&
;;;716    								(mdGsm.sGsmComInfo.RecvMessage[uiLoop+2]=='0') &&
;;;717    								(mdGsm.sGsmComInfo.RecvMessage[uiLoop+3]=='0') &&
;;;718    								(mdGsm.sGsmComInfo.RecvMessage[uiLoop+4]=='1'))
000070  2831              CMP      r0,#0x31
000072  d007              BEQ      |L20.132|
                  |L20.116|
000074  1c6d              ADDS     r5,r5,#1
000076  b2ad              UXTH     r5,r5                 ;697
000078  4295              CMP      r5,r2                 ;697
00007a  d3d5              BCC      |L20.40|
00007c  e01a              B        |L20.180|
                  |L20.126|
00007e  f24b30b0          MOV      r0,#0xb3b0            ;706
000082  e001              B        |L20.136|
                  |L20.132|
;;;719    								{	
;;;720    									/*中国联通*/
;;;721    									mdGsm.uiOperator = GSM_OPERATOR_CHINA_UNICOM;
000084  f24b30b1          MOV      r0,#0xb3b1
                  |L20.136|
000088  f8a40610          STRH     r0,[r4,#0x610]
;;;722    									mdGsm.uiGsmRepetWaitTimes = 0;
00008c  f8a4660e          STRH     r6,[r4,#0x60e]
;;;723    									mdGsm.uiGsmUsartFlag &=~GSM_SEND_ING;	/*清楚正在发送数据*/
000090  f8b40604          LDRH     r0,[r4,#0x604]  ; mdGsm
000094  f0200080          BIC      r0,r0,#0x80
000098  f8a40604          STRH     r0,[r4,#0x604]
;;;724    									mdGsm.sGsmComInfo.WorkFlage &=~GSM_RECV_NEW_DATA;/*清楚接受到新数据*/
00009c  f0210040          BIC      r0,r1,#0x40
0000a0  f8840602          STRB     r0,[r4,#0x602]
;;;725    									
;;;726    									return 1;
0000a4  2001              MOVS     r0,#1
;;;727    								}
;;;728    								
;;;729    								
;;;730    				}								
;;;731    		}
;;;732    		else
;;;733    		{
;;;734    				mdGsm.uiGsmUsartFlag &= ~GSM_SEND_ING;/*命令重试*/	
;;;735    		}
;;;736    	}
;;;737    	return 0;
;;;738    }
0000a6  bd70              POP      {r4-r6,pc}
                  |L20.168|
0000a8  f8b40604          LDRH     r0,[r4,#0x604]        ;734  ; mdGsm
0000ac  f0200080          BIC      r0,r0,#0x80           ;734
0000b0  f8a40604          STRH     r0,[r4,#0x604]        ;734
                  |L20.180|
0000b4  2000              MOVS     r0,#0                 ;737
0000b6  bd70              POP      {r4-r6,pc}
;;;739    /*模块注册登录*/
                          ENDP

                  |L20.184|
                          DCD      ||.bss||
                  |L20.188|
                          DCD      ||.bss||+0x400

                          AREA ||i.ReadGsmCOPSStr||, CODE, READONLY, ALIGN=2

                  ReadGsmCOPSStr PROC
;;;487    /*读取网络注册格式字符串*/
;;;488    uint16_t ReadGsmCOPSStr()
000000  b510              PUSH     {r4,lr}
;;;489    {
;;;490    	memset(mdGsm.sGsmComInfo.SendMessage,0,GSM_SEND_BUF_LEN);
000002  f44f7100          MOV      r1,#0x200
000006  4817              LDR      r0,|L21.100|
000008  f7fffffe          BL       __aeabi_memclr
;;;491    	
;;;492    	mdGsm.sGsmComInfo.SendMessage[0]='A';
00000c  4816              LDR      r0,|L21.104|
00000e  2141              MOVS     r1,#0x41
000010  f8801400          STRB     r1,[r0,#0x400]
;;;493    	mdGsm.sGsmComInfo.SendMessage[1]='T';
000014  2154              MOVS     r1,#0x54
000016  f8801401          STRB     r1,[r0,#0x401]
;;;494    	mdGsm.sGsmComInfo.SendMessage[2]='+';
00001a  212b              MOVS     r1,#0x2b
00001c  f8801402          STRB     r1,[r0,#0x402]
;;;495    	mdGsm.sGsmComInfo.SendMessage[3]='C';
000020  2143              MOVS     r1,#0x43
000022  f8801403          STRB     r1,[r0,#0x403]
;;;496    	mdGsm.sGsmComInfo.SendMessage[4]='O';
000026  214f              MOVS     r1,#0x4f
000028  f8801404          STRB     r1,[r0,#0x404]
;;;497    	mdGsm.sGsmComInfo.SendMessage[5]='P';
00002c  2150              MOVS     r1,#0x50
00002e  f8801405          STRB     r1,[r0,#0x405]
;;;498    	mdGsm.sGsmComInfo.SendMessage[6]='S';
000032  2153              MOVS     r1,#0x53
000034  f8801406          STRB     r1,[r0,#0x406]
;;;499    	mdGsm.sGsmComInfo.SendMessage[7]='=';
000038  213d              MOVS     r1,#0x3d
00003a  f8801407          STRB     r1,[r0,#0x407]
;;;500    	mdGsm.sGsmComInfo.SendMessage[8]='3';
00003e  2133              MOVS     r1,#0x33
000040  f8801408          STRB     r1,[r0,#0x408]
;;;501    	mdGsm.sGsmComInfo.SendMessage[9]=',';
000044  212c              MOVS     r1,#0x2c
000046  f8801409          STRB     r1,[r0,#0x409]
;;;502    	mdGsm.sGsmComInfo.SendMessage[10]='2';
00004a  2132              MOVS     r1,#0x32
00004c  f880140a          STRB     r1,[r0,#0x40a]
;;;503    	mdGsm.sGsmComInfo.SendMessage[11]='\r';
000050  210d              MOVS     r1,#0xd
000052  f880140b          STRB     r1,[r0,#0x40b]
;;;504    	mdGsm.sGsmComInfo.SendMessage[12] ='\n';
000056  220a              MOVS     r2,#0xa
000058  f880240c          STRB     r2,[r0,#0x40c]
;;;505    	
;;;506    	mdGsm.sGsmComInfo.SendCount = 13;
00005c  f8801601          STRB     r1,[r0,#0x601]
;;;507    }
000060  bd10              POP      {r4,pc}
;;;508    /*读取网络注册格式*/
                          ENDP

000062  0000              DCW      0x0000
                  |L21.100|
                          DCD      ||.bss||+0x400
                  |L21.104|
                          DCD      ||.bss||

                          AREA ||i.ReadGsmCSQ||, CODE, READONLY, ALIGN=2

                          REQUIRE _printf_percent
                          REQUIRE _printf_d
                          REQUIRE _printf_int_dec
                  ReadGsmCSQ PROC
;;;566    /*读取信号量强度*/
;;;567    uint16_t ReadGsmCSQ()
000000  e92d5ff0          PUSH     {r4-r12,lr}
;;;568    {
;;;569    	uint16_t uiLoop =0;
;;;570    	uint16_t uiJoop = 0;
;;;571    	uint16_t uiTemp = 0;
;;;572    	uint16_t uiKValue = 0;
;;;573    	if(!(mdGsm.uiGsmUsartFlag & GSM_SEND_ING))
000004  4e55              LDR      r6,|L22.348|
000006  2400              MOVS     r4,#0                 ;569
000008  f8b61604          LDRH     r1,[r6,#0x604]  ; mdGsm
00000c  0608              LSLS     r0,r1,#24
00000e  d439              BMI      |L22.132|
;;;574    	{
;;;575    		if(mdGsm.uiGsmRepetWaitTimes == 0)
000010  f8b6060e          LDRH     r0,[r6,#0x60e]  ; mdGsm
000014  46a3              MOV      r11,r4
000016  b188              CBZ      r0,|L22.60|
000018  1e40              SUBS     r0,r0,#1
;;;576    		{
;;;577    			mdGsm.uiGsmRepetWaitTimes = GSM_REPET_WAIT_TIME;
;;;578    			mdGsm.uiGsmUsartFlag |= GSM_SEND_ING;
;;;579    			ReadGsmCSQStr();
;;;580    			mdGsm.sGsmComInfo.RecvCount = 0;
;;;581    			CleanGsmRsp();	
;;;582    					
;;;583    			SendGsmControlCmd((char *)mdGsm.sGsmComInfo.SendMessage,
;;;584    												mdGsm.sGsmComInfo.SendCount);
;;;585    		}
;;;586    		else
;;;587    		{
;;;588    			mdGsm.uiGsmRepetWaitTimes--;
00001a  f8a6060e          STRH     r0,[r6,#0x60e]
;;;589    		}
;;;590    		/*接受到新数据*/
;;;591    		
;;;592    		if(mdGsm.sGsmComInfo.WorkFlage & GSM_RECV_NEW_DATA)
00001e  bf00              NOP      
                  |L22.32|
000020  f8960602          LDRB     r0,[r6,#0x602]  ; mdGsm
000024  0640              LSLS     r0,r0,#25
000026  d57c              BPL      |L22.290|
;;;593    		{
;;;594    				if(GsmRspCheckOK())
000028  f7fffffe          BL       GsmRspCheckOK
00002c  2800              CMP      r0,#0
00002e  d029              BEQ      |L22.132|
;;;595    				{
;;;596    					for(uiLoop = 0;uiLoop < GSM_RECV_BUFF_LEN;uiLoop++)
000030  f44f6180          MOV      r1,#0x400
                  |L22.52|
;;;597    					{
;;;598    							if((mdGsm.sGsmComInfo.RecvMessage[uiLoop]=='+') && 
000034  5d30              LDRB     r0,[r6,r4]
000036  282b              CMP      r0,#0x2b
000038  d013              BEQ      |L22.98|
00003a  e01f              B        |L22.124|
                  |L22.60|
00003c  200a              MOVS     r0,#0xa               ;577
00003e  f8a6060e          STRH     r0,[r6,#0x60e]        ;577
000042  f0410080          ORR      r0,r1,#0x80           ;578
000046  f8a60604          STRH     r0,[r6,#0x604]        ;578
00004a  f7fffffe          BL       ReadGsmCSQStr
00004e  f886b600          STRB     r11,[r6,#0x600]       ;580
000052  f7fffffe          BL       CleanGsmRsp
000056  f8961601          LDRB     r1,[r6,#0x601]        ;583  ; mdGsm
00005a  4841              LDR      r0,|L22.352|
00005c  f7fffffe          BL       SendGsmControlCmd
000060  e7de              B        |L22.32|
                  |L22.98|
;;;599    								(mdGsm.sGsmComInfo.RecvMessage[uiLoop+1]=='C') &&
000062  1930              ADDS     r0,r6,r4
000064  7842              LDRB     r2,[r0,#1]
000066  2a43              CMP      r2,#0x43
000068  d108              BNE      |L22.124|
;;;600    								(mdGsm.sGsmComInfo.RecvMessage[uiLoop+2]=='S') &&
00006a  7882              LDRB     r2,[r0,#2]
00006c  2a53              CMP      r2,#0x53
00006e  d105              BNE      |L22.124|
;;;601    								(mdGsm.sGsmComInfo.RecvMessage[uiLoop+3]=='Q') &&
000070  78c2              LDRB     r2,[r0,#3]
000072  2a51              CMP      r2,#0x51
000074  d102              BNE      |L22.124|
;;;602    								(mdGsm.sGsmComInfo.RecvMessage[uiLoop+4]==':'))
000076  7900              LDRB     r0,[r0,#4]
000078  283a              CMP      r0,#0x3a
00007a  d004              BEQ      |L22.134|
                  |L22.124|
00007c  1c64              ADDS     r4,r4,#1
00007e  b2a4              UXTH     r4,r4                 ;596
000080  428c              CMP      r4,r1                 ;596
000082  d3d7              BCC      |L22.52|
                  |L22.132|
000084  e068              B        |L22.344|
                  |L22.134|
;;;603    								{
;;;604    									uiKValue = 0;
000086  2500              MOVS     r5,#0
;;;605    									for(uiJoop = 6; uiJoop < 8;uiJoop++)
000088  2706              MOVS     r7,#6
                  |L22.138|
;;;606    									{
;;;607    										if((mdGsm.sGsmComInfo.RecvMessage[uiJoop +uiLoop]>='0') &&
00008a  1938              ADDS     r0,r7,r4
00008c  5c30              LDRB     r0,[r6,r0]
00008e  3830              SUBS     r0,r0,#0x30
000090  2809              CMP      r0,#9
000092  d818              BHI      |L22.198|
;;;608    											(mdGsm.sGsmComInfo.RecvMessage[uiJoop +uiLoop]<='9'))
;;;609    										{
;;;610    												uiTemp = mdGsm.sGsmComInfo.RecvMessage[uiJoop +uiLoop] - 0x30;
000094  fa1ffa80          UXTH     r10,r0
;;;611    												uiTemp *= pow(10,(7 - uiJoop));
000098  f1c70007          RSB      r0,r7,#7
00009c  f7fffffe          BL       __aeabi_i2d
0000a0  460b              MOV      r3,r1
0000a2  4602              MOV      r2,r0
0000a4  2000              MOVS     r0,#0
0000a6  492f              LDR      r1,|L22.356|
0000a8  f7fffffe          BL       pow
0000ac  4680              MOV      r8,r0
0000ae  4689              MOV      r9,r1
0000b0  4650              MOV      r0,r10
0000b2  f7fffffe          BL       __aeabi_ui2d
0000b6  4642              MOV      r2,r8
0000b8  464b              MOV      r3,r9
0000ba  f7fffffe          BL       __aeabi_dmul
0000be  f7fffffe          BL       __aeabi_d2uiz
;;;612    											  uiKValue += uiTemp;
0000c2  4428              ADD      r0,r0,r5
0000c4  b285              UXTH     r5,r0
                  |L22.198|
0000c6  1c7f              ADDS     r7,r7,#1
0000c8  b2bf              UXTH     r7,r7                 ;605
0000ca  2f08              CMP      r7,#8                 ;605
0000cc  d3dd              BCC      |L22.138|
;;;613    										}
;;;614    									}
;;;615    									
;;;616    									mdGsm.uiGsmSingnelValue = uiKValue;
0000ce  f8a65606          STRH     r5,[r6,#0x606]
;;;617    									uiKValue = 0;
0000d2  2700              MOVS     r7,#0
;;;618    									for(uiJoop = 10; uiJoop < 12;uiJoop++)
0000d4  250a              MOVS     r5,#0xa
                  |L22.214|
;;;619    									{
;;;620    										if((mdGsm.sGsmComInfo.RecvMessage[uiJoop +uiLoop]>='0') &&
0000d6  1928              ADDS     r0,r5,r4
0000d8  5c30              LDRB     r0,[r6,r0]
0000da  3830              SUBS     r0,r0,#0x30
0000dc  2809              CMP      r0,#9
0000de  d818              BHI      |L22.274|
;;;621    											(mdGsm.sGsmComInfo.RecvMessage[uiJoop +uiLoop]<='9'))
;;;622    										{
;;;623    												uiTemp = mdGsm.sGsmComInfo.RecvMessage[uiJoop +uiLoop] - 0x30;
0000e0  fa1ffa80          UXTH     r10,r0
;;;624    												uiTemp *= pow(10,(11 - uiJoop));
0000e4  f1c5000b          RSB      r0,r5,#0xb
0000e8  f7fffffe          BL       __aeabi_i2d
0000ec  4602              MOV      r2,r0
0000ee  460b              MOV      r3,r1
0000f0  2000              MOVS     r0,#0
0000f2  491c              LDR      r1,|L22.356|
0000f4  f7fffffe          BL       pow
0000f8  4680              MOV      r8,r0
0000fa  4689              MOV      r9,r1
0000fc  4650              MOV      r0,r10
0000fe  f7fffffe          BL       __aeabi_ui2d
000102  4642              MOV      r2,r8
000104  464b              MOV      r3,r9
000106  f7fffffe          BL       __aeabi_dmul
00010a  f7fffffe          BL       __aeabi_d2uiz
;;;625    											  uiKValue += uiTemp;
00010e  4438              ADD      r0,r0,r7
000110  b287              UXTH     r7,r0
                  |L22.274|
000112  1c6d              ADDS     r5,r5,#1
000114  b2ad              UXTH     r5,r5                 ;618
000116  2d0c              CMP      r5,#0xc               ;618
000118  d3dd              BCC      |L22.214|
;;;626    										}
;;;627    									}
;;;628    									mdGsm.uiGsmSingnelBer = uiKValue;
00011a  463a              MOV      r2,r7
00011c  f8a67608          STRH     r7,[r6,#0x608]
;;;629    									
;;;630    									if(LOG_CENTER_LEVE == LOG_DEBUG)
;;;631    									{
;;;632    										printf("Signel:%d  SignelBer:%d \n",mdGsm.uiGsmSingnelValue,
000120  e000              B        |L22.292|
                  |L22.290|
000122  e013              B        |L22.332|
                  |L22.292|
000124  f8b61606          LDRH     r1,[r6,#0x606]  ; mdGsm
000128  a00f              ADR      r0,|L22.360|
00012a  f2066602          ADD      r6,r6,#0x602
00012e  f7fffffe          BL       __2printf
;;;633    																											mdGsm.uiGsmSingnelBer);
;;;634    									}
;;;635    									mdGsm.uiGsmRepetWaitTimes = 0;
000132  f8a6b00c          STRH     r11,[r6,#0xc]
;;;636    									mdGsm.uiGsmUsartFlag &=~GSM_SEND_ING;	/*清楚正在发送数据*/
000136  8870              LDRH     r0,[r6,#2]  ; mdGsm
000138  f0200080          BIC      r0,r0,#0x80
00013c  8070              STRH     r0,[r6,#2]
;;;637    									mdGsm.sGsmComInfo.WorkFlage &=~GSM_RECV_NEW_DATA;/*清楚接受到新数据*/
00013e  7830              LDRB     r0,[r6,#0]  ; mdGsm
000140  f0200040          BIC      r0,r0,#0x40
000144  7030              STRB     r0,[r6,#0]
;;;638    									
;;;639    									return 1;
000146  2001              MOVS     r0,#1
                  |L22.328|
;;;640    								}
;;;641    					}
;;;642    				}				
;;;643    		}
;;;644    		else
;;;645    		{
;;;646    				mdGsm.uiGsmUsartFlag &= ~GSM_SEND_ING;/*命令重试*/	
;;;647    		}
;;;648    	}
;;;649    	return 0;
;;;650    }
000148  e8bd9ff0          POP      {r4-r12,pc}
                  |L22.332|
00014c  f8b60604          LDRH     r0,[r6,#0x604]        ;646  ; mdGsm
000150  f0200080          BIC      r0,r0,#0x80           ;646
000154  f8a60604          STRH     r0,[r6,#0x604]        ;646
                  |L22.344|
000158  2000              MOVS     r0,#0                 ;649
00015a  e7f5              B        |L22.328|
;;;651    /*读取运营商命令*/
                          ENDP

                  |L22.348|
                          DCD      ||.bss||
                  |L22.352|
                          DCD      ||.bss||+0x400
                  |L22.356|
                          DCD      0x40240000
                  |L22.360|
000168  5369676e          DCB      "Signel:%d  SignelBer:%d \n",0
00016c  656c3a25
000170  64202053
000174  69676e65
000178  6c426572
00017c  3a256420
000180  0a00    
000182  00                DCB      0
000183  00                DCB      0

                          AREA ||i.ReadGsmCSQStr||, CODE, READONLY, ALIGN=2

                  ReadGsmCSQStr PROC
;;;550    /*读取信号量强度命令*/
;;;551    uint16_t ReadGsmCSQStr()
000000  b510              PUSH     {r4,lr}
;;;552    {
;;;553    	memset(mdGsm.sGsmComInfo.SendMessage,0,GSM_SEND_BUF_LEN);
000002  f44f7100          MOV      r1,#0x200
000006  4810              LDR      r0,|L23.72|
000008  f7fffffe          BL       __aeabi_memclr
;;;554    	
;;;555    	mdGsm.sGsmComInfo.SendMessage[0]='A';
00000c  480f              LDR      r0,|L23.76|
00000e  2141              MOVS     r1,#0x41
000010  f8801400          STRB     r1,[r0,#0x400]
;;;556    	mdGsm.sGsmComInfo.SendMessage[1]='T';
000014  2154              MOVS     r1,#0x54
000016  f8801401          STRB     r1,[r0,#0x401]
;;;557    	mdGsm.sGsmComInfo.SendMessage[2]='+';
00001a  212b              MOVS     r1,#0x2b
00001c  f8801402          STRB     r1,[r0,#0x402]
;;;558    	mdGsm.sGsmComInfo.SendMessage[3]='C';
000020  2143              MOVS     r1,#0x43
000022  f8801403          STRB     r1,[r0,#0x403]
;;;559    	mdGsm.sGsmComInfo.SendMessage[4]='S';
000026  2153              MOVS     r1,#0x53
000028  f8801404          STRB     r1,[r0,#0x404]
;;;560    	mdGsm.sGsmComInfo.SendMessage[5]='Q';
00002c  2151              MOVS     r1,#0x51
00002e  f8801405          STRB     r1,[r0,#0x405]
;;;561    	mdGsm.sGsmComInfo.SendMessage[6]='\r';
000032  210d              MOVS     r1,#0xd
000034  f8801406          STRB     r1,[r0,#0x406]
;;;562    	mdGsm.sGsmComInfo.SendMessage[7]='\n';
000038  210a              MOVS     r1,#0xa
00003a  f8801407          STRB     r1,[r0,#0x407]
;;;563    	
;;;564    	mdGsm.sGsmComInfo.SendCount = 8;
00003e  2108              MOVS     r1,#8
000040  f8801601          STRB     r1,[r0,#0x601]
;;;565    }
000044  bd10              POP      {r4,pc}
;;;566    /*读取信号量强度*/
                          ENDP

000046  0000              DCW      0x0000
                  |L23.72|
                          DCD      ||.bss||+0x400
                  |L23.76|
                          DCD      ||.bss||

                          AREA ||i.ReadGsmPIN||, CODE, READONLY, ALIGN=2

                  ReadGsmPIN PROC
;;;439    /*读取PIN号码*/
;;;440    uint16_t ReadGsmPIN()
000000  b570              PUSH     {r4-r6,lr}
;;;441    {
;;;442    	uint16_t uiLoop =0;
;;;443    	uint8_t flage =0;
;;;444    	if(!(mdGsm.uiGsmUsartFlag & GSM_SEND_ING))
000002  4d29              LDR      r5,|L24.168|
000004  2400              MOVS     r4,#0                 ;442
000006  f8b51604          LDRH     r1,[r5,#0x604]  ; mdGsm
00000a  0608              LSLS     r0,r1,#24
00000c  d449              BMI      |L24.162|
;;;445    	{
;;;446    		if(mdGsm.uiGsmRepetWaitTimes == 0)
00000e  f8b5060e          LDRH     r0,[r5,#0x60e]  ; mdGsm
000012  2600              MOVS     r6,#0
000014  b160              CBZ      r0,|L24.48|
000016  1e40              SUBS     r0,r0,#1
;;;447    		{
;;;448    			mdGsm.uiGsmRepetWaitTimes = GSM_REPET_WAIT_TIME;
;;;449    			mdGsm.uiGsmUsartFlag |= GSM_SEND_ING;
;;;450    			ReadGsmPinStr();
;;;451    			mdGsm.sGsmComInfo.RecvCount = 0;
;;;452    			CleanGsmRsp();			
;;;453    			SendGsmControlCmd((char *)mdGsm.sGsmComInfo.SendMessage,
;;;454    												mdGsm.sGsmComInfo.SendCount);
;;;455    		}
;;;456    		else
;;;457    		{
;;;458    			mdGsm.uiGsmRepetWaitTimes--;
000018  f8a5060e          STRH     r0,[r5,#0x60e]
                  |L24.28|
;;;459    		}
;;;460    		/*接受到新数据*/
;;;461    		
;;;462    		if(mdGsm.sGsmComInfo.WorkFlage & GSM_RECV_NEW_DATA)
00001c  f8951602          LDRB     r1,[r5,#0x602]  ; mdGsm
000020  0648              LSLS     r0,r1,#25
000022  d538              BPL      |L24.150|
;;;463    		{
;;;464    			for(uiLoop = 0;uiLoop < GSM_RECV_BUFF_LEN;uiLoop++)
000024  f44f6280          MOV      r2,#0x400
                  |L24.40|
;;;465    			{
;;;466    					if((mdGsm.sGsmComInfo.RecvMessage[uiLoop]=='R') && 
000028  5d28              LDRB     r0,[r5,r4]
00002a  2852              CMP      r0,#0x52
00002c  d013              BEQ      |L24.86|
00002e  e01f              B        |L24.112|
                  |L24.48|
000030  200a              MOVS     r0,#0xa               ;448
000032  f8a5060e          STRH     r0,[r5,#0x60e]        ;448
000036  f0410080          ORR      r0,r1,#0x80           ;449
00003a  f8a50604          STRH     r0,[r5,#0x604]        ;449
00003e  f7fffffe          BL       ReadGsmPinStr
000042  f8856600          STRB     r6,[r5,#0x600]        ;451
000046  f7fffffe          BL       CleanGsmRsp
00004a  f8951601          LDRB     r1,[r5,#0x601]        ;453  ; mdGsm
00004e  4817              LDR      r0,|L24.172|
000050  f7fffffe          BL       SendGsmControlCmd
000054  e7e2              B        |L24.28|
                  |L24.86|
;;;467    						(mdGsm.sGsmComInfo.RecvMessage[uiLoop+1]=='E') &&
000056  1928              ADDS     r0,r5,r4
000058  7843              LDRB     r3,[r0,#1]
00005a  2b45              CMP      r3,#0x45
00005c  d108              BNE      |L24.112|
;;;468    						(mdGsm.sGsmComInfo.RecvMessage[uiLoop+2]=='A') &&
00005e  7883              LDRB     r3,[r0,#2]
000060  2b41              CMP      r3,#0x41
000062  d105              BNE      |L24.112|
;;;469    						(mdGsm.sGsmComInfo.RecvMessage[uiLoop+3]=='D') &&
000064  78c3              LDRB     r3,[r0,#3]
000066  2b44              CMP      r3,#0x44
000068  d102              BNE      |L24.112|
;;;470    						(mdGsm.sGsmComInfo.RecvMessage[uiLoop+4]=='Y'))
00006a  7900              LDRB     r0,[r0,#4]
00006c  2859              CMP      r0,#0x59
00006e  d004              BEQ      |L24.122|
                  |L24.112|
000070  1c64              ADDS     r4,r4,#1
000072  b2a4              UXTH     r4,r4                 ;464
000074  4294              CMP      r4,r2                 ;464
000076  d3d7              BCC      |L24.40|
000078  e013              B        |L24.162|
                  |L24.122|
;;;471    						{
;;;472    							mdGsm.uiGsmRepetWaitTimes = 0;
00007a  f8a5660e          STRH     r6,[r5,#0x60e]
;;;473    							mdGsm.uiGsmUsartFlag &=~GSM_SEND_ING;	/*清楚正在发送数据*/
00007e  f8b50604          LDRH     r0,[r5,#0x604]  ; mdGsm
000082  f0200080          BIC      r0,r0,#0x80
000086  f8a50604          STRH     r0,[r5,#0x604]
;;;474    							mdGsm.sGsmComInfo.WorkFlage &=~GSM_RECV_NEW_DATA;/*清楚接受到新数据*/
00008a  f0210040          BIC      r0,r1,#0x40
00008e  f8850602          STRB     r0,[r5,#0x602]
;;;475    							
;;;476    							return 1;
000092  2001              MOVS     r0,#1
;;;477    						}
;;;478    			}
;;;479    		}
;;;480    		else
;;;481    		{
;;;482    				mdGsm.uiGsmUsartFlag &= ~GSM_SEND_ING;/*命令重试*/	
;;;483    		}
;;;484    	}
;;;485    	return 0;
;;;486    }
000094  bd70              POP      {r4-r6,pc}
                  |L24.150|
000096  f8b50604          LDRH     r0,[r5,#0x604]        ;482  ; mdGsm
00009a  f0200080          BIC      r0,r0,#0x80           ;482
00009e  f8a50604          STRH     r0,[r5,#0x604]        ;482
                  |L24.162|
0000a2  2000              MOVS     r0,#0                 ;485
0000a4  bd70              POP      {r4-r6,pc}
;;;487    /*读取网络注册格式字符串*/
                          ENDP

0000a6  0000              DCW      0x0000
                  |L24.168|
                          DCD      ||.bss||
                  |L24.172|
                          DCD      ||.bss||+0x400

                          AREA ||i.ReadGsmPinStr||, CODE, READONLY, ALIGN=2

                  ReadGsmPinStr PROC
;;;422    /*读取pin号码字符串*/
;;;423    uint16_t ReadGsmPinStr()
000000  b510              PUSH     {r4,lr}
;;;424    {
;;;425    	memset(mdGsm.sGsmComInfo.SendMessage,0,GSM_SEND_BUF_LEN);
000002  f44f7100          MOV      r1,#0x200
000006  4812              LDR      r0,|L25.80|
000008  f7fffffe          BL       __aeabi_memclr
;;;426    	
;;;427    	mdGsm.sGsmComInfo.SendMessage[0]='A';
00000c  4811              LDR      r0,|L25.84|
00000e  2141              MOVS     r1,#0x41
000010  f8801400          STRB     r1,[r0,#0x400]
;;;428    	mdGsm.sGsmComInfo.SendMessage[1]='T';
000014  2154              MOVS     r1,#0x54
000016  f8801401          STRB     r1,[r0,#0x401]
;;;429    	mdGsm.sGsmComInfo.SendMessage[2]='+';
00001a  212b              MOVS     r1,#0x2b
00001c  f8801402          STRB     r1,[r0,#0x402]
;;;430    	mdGsm.sGsmComInfo.SendMessage[3]='C';
000020  2143              MOVS     r1,#0x43
000022  f8801403          STRB     r1,[r0,#0x403]
;;;431    	mdGsm.sGsmComInfo.SendMessage[4]='P';
000026  2150              MOVS     r1,#0x50
000028  f8801404          STRB     r1,[r0,#0x404]
;;;432    	mdGsm.sGsmComInfo.SendMessage[5]='I';
00002c  2149              MOVS     r1,#0x49
00002e  f8801405          STRB     r1,[r0,#0x405]
;;;433    	mdGsm.sGsmComInfo.SendMessage[6]='N';
000032  214e              MOVS     r1,#0x4e
000034  f8801406          STRB     r1,[r0,#0x406]
;;;434    	mdGsm.sGsmComInfo.SendMessage[7]='?';
000038  213f              MOVS     r1,#0x3f
00003a  f8801407          STRB     r1,[r0,#0x407]
;;;435    	mdGsm.sGsmComInfo.SendMessage[8]='\r';
00003e  210d              MOVS     r1,#0xd
000040  f8801408          STRB     r1,[r0,#0x408]
;;;436    	mdGsm.sGsmComInfo.SendMessage[9]='\n';
000044  210a              MOVS     r1,#0xa
000046  f8801409          STRB     r1,[r0,#0x409]
;;;437    	mdGsm.sGsmComInfo.SendCount = 10;
00004a  f8801601          STRB     r1,[r0,#0x601]
;;;438    }
00004e  bd10              POP      {r4,pc}
;;;439    /*读取PIN号码*/
                          ENDP

                  |L25.80|
                          DCD      ||.bss||+0x400
                  |L25.84|
                          DCD      ||.bss||

                          AREA ||i.ReadSIMINS||, CODE, READONLY, ALIGN=2

                  ReadSIMINS PROC
;;;364    /*读取卡状态*/
;;;365    uint16_t ReadSIMINS()
000000  b570              PUSH     {r4-r6,lr}
;;;366    {
;;;367    	uint16_t uiLoop =0,k =0;
;;;368    	uint8_t flage =0;
;;;369    	if(!(mdGsm.uiGsmUsartFlag & GSM_SEND_ING))
000002  4d36              LDR      r5,|L26.220|
000004  2400              MOVS     r4,#0                 ;367
000006  f8b51604          LDRH     r1,[r5,#0x604]  ; mdGsm
00000a  0608              LSLS     r0,r1,#24
00000c  d463              BMI      |L26.214|
;;;370    	{
;;;371    		if(mdGsm.uiGsmRepetWaitTimes == 0)
00000e  f8b5060e          LDRH     r0,[r5,#0x60e]  ; mdGsm
000012  2600              MOVS     r6,#0
000014  b150              CBZ      r0,|L26.44|
000016  1e40              SUBS     r0,r0,#1
;;;372    		{
;;;373    			mdGsm.uiGsmRepetWaitTimes = GSM_REPET_WAIT_TIME;
;;;374    			mdGsm.uiGsmUsartFlag |= GSM_SEND_ING;
;;;375    			ReadSIMINSStr();
;;;376    			mdGsm.sGsmComInfo.RecvCount = 0;
;;;377    			CleanGsmRsp();	
;;;378    					
;;;379    			SendGsmControlCmd((char *)mdGsm.sGsmComInfo.SendMessage,
;;;380    												mdGsm.sGsmComInfo.SendCount);
;;;381    		}
;;;382    		else
;;;383    		{
;;;384    			mdGsm.uiGsmRepetWaitTimes--;
000018  f8a5060e          STRH     r0,[r5,#0x60e]
                  |L26.28|
;;;385    		}
;;;386    		/*接受到新数据*/
;;;387    		
;;;388    		if(mdGsm.sGsmComInfo.WorkFlage & GSM_RECV_NEW_DATA)
00001c  f8950602          LDRB     r0,[r5,#0x602]  ; mdGsm
000020  0640              LSLS     r0,r0,#25
000022  d552              BPL      |L26.202|
                  |L26.36|
;;;389    		{
;;;390    			for(uiLoop = 0;uiLoop < GSM_RECV_BUFF_LEN;uiLoop++)
;;;391    			{
;;;392    					if((mdGsm.sGsmComInfo.RecvMessage[uiLoop]=='*')&&(mdGsm.sGsmComInfo.RecvMessage[uiLoop+1]=='T')&&(mdGsm.sGsmComInfo.RecvMessage[uiLoop+2]=='S')	\
000024  5d28              LDRB     r0,[r5,r4]
000026  282a              CMP      r0,#0x2a
000028  d013              BEQ      |L26.82|
00002a  e048              B        |L26.190|
                  |L26.44|
00002c  200a              MOVS     r0,#0xa               ;373
00002e  f8a5060e          STRH     r0,[r5,#0x60e]        ;373
000032  f0410080          ORR      r0,r1,#0x80           ;374
000036  f8a50604          STRH     r0,[r5,#0x604]        ;374
00003a  f7fffffe          BL       ReadSIMINSStr
00003e  f8856600          STRB     r6,[r5,#0x600]        ;376
000042  f7fffffe          BL       CleanGsmRsp
000046  f8951601          LDRB     r1,[r5,#0x601]        ;379  ; mdGsm
00004a  4825              LDR      r0,|L26.224|
00004c  f7fffffe          BL       SendGsmControlCmd
000050  e7e4              B        |L26.28|
                  |L26.82|
000052  1928              ADDS     r0,r5,r4
000054  7841              LDRB     r1,[r0,#1]
000056  2954              CMP      r1,#0x54
000058  d131              BNE      |L26.190|
00005a  7881              LDRB     r1,[r0,#2]
00005c  2953              CMP      r1,#0x53
00005e  d12e              BNE      |L26.190|
;;;393    						&&(mdGsm.sGsmComInfo.RecvMessage[uiLoop+3]=='I')&&(mdGsm.sGsmComInfo.RecvMessage[uiLoop+4]=='M')&&(mdGsm.sGsmComInfo.RecvMessage[uiLoop+5]=='I') \
000060  78c1              LDRB     r1,[r0,#3]
000062  2949              CMP      r1,#0x49
000064  d12b              BNE      |L26.190|
000066  7901              LDRB     r1,[r0,#4]
000068  294d              CMP      r1,#0x4d
00006a  d128              BNE      |L26.190|
00006c  7941              LDRB     r1,[r0,#5]
00006e  2949              CMP      r1,#0x49
000070  d125              BNE      |L26.190|
;;;394    						&&(mdGsm.sGsmComInfo.RecvMessage[uiLoop+6]=='N')&&(mdGsm.sGsmComInfo.RecvMessage[uiLoop+7]=='S')&&(mdGsm.sGsmComInfo.RecvMessage[uiLoop+8]==':'))
000072  7981              LDRB     r1,[r0,#6]
000074  294e              CMP      r1,#0x4e
000076  d122              BNE      |L26.190|
000078  79c1              LDRB     r1,[r0,#7]
00007a  2953              CMP      r1,#0x53
00007c  d11f              BNE      |L26.190|
00007e  7a01              LDRB     r1,[r0,#8]
000080  293a              CMP      r1,#0x3a
000082  d11c              BNE      |L26.190|
;;;395    					{
;;;396    						mdGsm.uiGsmRepetWaitTimes =0;
000084  f8a5660e          STRH     r6,[r5,#0x60e]
;;;397    						if((mdGsm.sGsmComInfo.RecvMessage[uiLoop+12]>='0')&&(mdGsm.sGsmComInfo.RecvMessage[uiLoop+12]<='9'))
000088  7b00              LDRB     r0,[r0,#0xc]
00008a  3830              SUBS     r0,r0,#0x30
00008c  2809              CMP      r0,#9
00008e  d813              BHI      |L26.184|
;;;398    						{
;;;399    							k=mdGsm.sGsmComInfo.RecvMessage[uiLoop+12]-0x30;
000090  0400              LSLS     r0,r0,#16
000092  0c00              LSRS     r0,r0,#16
000094  d010              BEQ      |L26.184|
;;;400    						}
;;;401    						if(k>0)
;;;402    						{
;;;403    							LogMsgStr(LOG_DEBUG,"SIM Card OK\r\n");
000096  a013              ADR      r0,|L26.228|
000098  f7fffffe          BL       __2printf
;;;404    							mdGsm.uiGsmUsartFlag &=~GSM_SEND_ING;
00009c  f8b50604          LDRH     r0,[r5,#0x604]  ; mdGsm
0000a0  f0200080          BIC      r0,r0,#0x80
0000a4  f8a50604          STRH     r0,[r5,#0x604]
;;;405    							mdGsm.sGsmComInfo.WorkFlage &=~GSM_RECV_NEW_DATA;
0000a8  f8950602          LDRB     r0,[r5,#0x602]  ; mdGsm
0000ac  f0200040          BIC      r0,r0,#0x40
0000b0  f8850602          STRB     r0,[r5,#0x602]
;;;406    							return 1;
0000b4  2001              MOVS     r0,#1
;;;407    						}
;;;408    						else
;;;409    						{
;;;410    							LogMsgStr(LOG_DEBUG,"SIM Card ERROR\r\n");
;;;411    						}
;;;412    					}
;;;413    			}	
;;;414    		}
;;;415    		else
;;;416    		{
;;;417    				mdGsm.uiGsmUsartFlag &= ~GSM_SEND_ING;/*命令重试*/	
;;;418    		}
;;;419    	}
;;;420    	return 0;
;;;421    }
0000b6  bd70              POP      {r4-r6,pc}
                  |L26.184|
0000b8  a00e              ADR      r0,|L26.244|
0000ba  f7fffffe          BL       __2printf
                  |L26.190|
0000be  1c64              ADDS     r4,r4,#1              ;410
0000c0  b2a4              UXTH     r4,r4                 ;390
0000c2  f5b46f80          CMP      r4,#0x400             ;390
0000c6  d3ad              BCC      |L26.36|
0000c8  e005              B        |L26.214|
                  |L26.202|
0000ca  f8b50604          LDRH     r0,[r5,#0x604]        ;417  ; mdGsm
0000ce  f0200080          BIC      r0,r0,#0x80           ;417
0000d2  f8a50604          STRH     r0,[r5,#0x604]        ;417
                  |L26.214|
0000d6  2000              MOVS     r0,#0                 ;420
0000d8  bd70              POP      {r4-r6,pc}
;;;422    /*读取pin号码字符串*/
                          ENDP

0000da  0000              DCW      0x0000
                  |L26.220|
                          DCD      ||.bss||
                  |L26.224|
                          DCD      ||.bss||+0x400
                  |L26.228|
0000e4  53494d20          DCB      "SIM Card OK\r\n",0
0000e8  43617264
0000ec  204f4b0d
0000f0  0a00    
0000f2  00                DCB      0
0000f3  00                DCB      0
                  |L26.244|
0000f4  53494d20          DCB      "SIM Card ERROR\r\n",0
0000f8  43617264
0000fc  20455252
000100  4f520d0a
000104  00      
000105  00                DCB      0
000106  00                DCB      0
000107  00                DCB      0

                          AREA ||i.ReadSIMINSStr||, CODE, READONLY, ALIGN=2

                  ReadSIMINSStr PROC
;;;343    /*读取卡状态命令*/
;;;344    uint16_t ReadSIMINSStr()
000000  b510              PUSH     {r4,lr}
;;;345    {
;;;346    	memset(mdGsm.sGsmComInfo.SendMessage,0,GSM_SEND_BUF_LEN);
000002  f44f7100          MOV      r1,#0x200
000006  4815              LDR      r0,|L27.92|
000008  f7fffffe          BL       __aeabi_memclr
;;;347    	mdGsm.sGsmComInfo.SendMessage[0]='A';
00000c  4814              LDR      r0,|L27.96|
00000e  2141              MOVS     r1,#0x41
;;;348    	mdGsm.sGsmComInfo.SendMessage[1]='T';
;;;349    	mdGsm.sGsmComInfo.SendMessage[2]='*';
000010  222a              MOVS     r2,#0x2a
000012  f8801400          STRB     r1,[r0,#0x400]        ;347
000016  2154              MOVS     r1,#0x54              ;348
000018  f8801401          STRB     r1,[r0,#0x401]        ;348
00001c  f8802402          STRB     r2,[r0,#0x402]
;;;350    	mdGsm.sGsmComInfo.SendMessage[3]='T';
000020  f8801403          STRB     r1,[r0,#0x403]
;;;351    	mdGsm.sGsmComInfo.SendMessage[4]='S';
000024  2153              MOVS     r1,#0x53
000026  f8801404          STRB     r1,[r0,#0x404]
;;;352    	mdGsm.sGsmComInfo.SendMessage[5]='I';
00002a  2249              MOVS     r2,#0x49
00002c  f8802405          STRB     r2,[r0,#0x405]
;;;353    	mdGsm.sGsmComInfo.SendMessage[6]='M';
000030  234d              MOVS     r3,#0x4d
000032  f8803406          STRB     r3,[r0,#0x406]
;;;354    	mdGsm.sGsmComInfo.SendMessage[7]='I';
000036  f8802407          STRB     r2,[r0,#0x407]
;;;355    	mdGsm.sGsmComInfo.SendMessage[8]='N';
00003a  224e              MOVS     r2,#0x4e
00003c  f8802408          STRB     r2,[r0,#0x408]
;;;356    	mdGsm.sGsmComInfo.SendMessage[9]='S';
000040  f8801409          STRB     r1,[r0,#0x409]
;;;357    	mdGsm.sGsmComInfo.SendMessage[10]='?';
000044  213f              MOVS     r1,#0x3f
000046  f880140a          STRB     r1,[r0,#0x40a]
;;;358    	mdGsm.sGsmComInfo.SendMessage[11]='\r';
00004a  210d              MOVS     r1,#0xd
00004c  f880140b          STRB     r1,[r0,#0x40b]
;;;359    	mdGsm.sGsmComInfo.SendMessage[12]='\n';
000050  220a              MOVS     r2,#0xa
000052  f880240c          STRB     r2,[r0,#0x40c]
;;;360    	
;;;361    	mdGsm.sGsmComInfo.SendCount = 13;
000056  f8801601          STRB     r1,[r0,#0x601]
;;;362    }
00005a  bd10              POP      {r4,pc}
;;;363    
                          ENDP

                  |L27.92|
                          DCD      ||.bss||+0x400
                  |L27.96|
                          DCD      ||.bss||

                          AREA ||i.SendGsmControlCmd||, CODE, READONLY, ALIGN=2

                  SendGsmControlCmd PROC
;;;10     /*发送模块控制命令，这里是对串口发送命令的封装*/
;;;11     uint8_t SendGsmControlCmd(char *Buff,uint16_t sizes)
000000  460a              MOV      r2,r1
;;;12     {
000002  b510              PUSH     {r4,lr}
;;;13     	USARTWrite(GSM_USAET,Buff,sizes);
000004  4601              MOV      r1,r0
000006  4802              LDR      r0,|L28.16|
000008  f7fffffe          BL       USARTWrite
;;;14     }
00000c  bd10              POP      {r4,pc}
;;;15     /*清楚接史祷剀*/
                          ENDP

00000e  0000              DCW      0x0000
                  |L28.16|
                          DCD      0x40004400

                          AREA ||i.SetGsmAte||, CODE, READONLY, ALIGN=2

                  SetGsmAte PROC
;;;55     /*回显控制*/
;;;56     uint8_t SetGsmAte(uint8_t cmd)
000000  e92d41f0          PUSH     {r4-r8,lr}
;;;57     {
;;;58     	/*模块未在发送过程中*/
;;;59     	static uint8_t flage =0,CmdRepetTimes =0;
;;;60     	if(!(mdGsm.uiGsmUsartFlag & GSM_SEND_ING))
000004  4c24              LDR      r4,|L29.152|
000006  4607              MOV      r7,r0                 ;57
;;;61     	{
;;;62     		mdGsm.uiGsmUsartFlag |= GSM_SEND_ING;
;;;63     		if(flage == 0)
000008  4d24              LDR      r5,|L29.156|
00000a  f8b40604          LDRH     r0,[r4,#0x604]        ;60  ; mdGsm
00000e  f04f0600          MOV      r6,#0                 ;60
000012  0601              LSLS     r1,r0,#24             ;60
000014  d411              BMI      |L29.58|
000016  f0400080          ORR      r0,r0,#0x80           ;62
00001a  f8a40604          STRH     r0,[r4,#0x604]        ;62
00001e  7828              LDRB     r0,[r5,#0]  ; flage
000020  b918              CBNZ     r0,|L29.42|
;;;64     		{
;;;65     			CleanGsmRsp();
000022  f7fffffe          BL       CleanGsmRsp
;;;66     			mdGsm.sGsmComInfo.RecvCount = 0;/*清空接受技术*/
000026  f8846600          STRB     r6,[r4,#0x600]
                  |L29.42|
;;;67     		}
;;;68     		SetGsmAteStr(cmd);/*发送回显控制*/
00002a  4638              MOV      r0,r7
00002c  f7fffffe          BL       SetGsmAteStr
;;;69     		
;;;70     		SendGsmControlCmd((char *)mdGsm.sGsmComInfo.SendMessage,
000030  f8941601          LDRB     r1,[r4,#0x601]  ; mdGsm
000034  481a              LDR      r0,|L29.160|
000036  f7fffffe          BL       SendGsmControlCmd
                  |L29.58|
;;;71     											mdGsm.sGsmComInfo.SendCount);
;;;72     		/*发送命令*/
;;;73     	}
;;;74     	/*接受到新数据*/
;;;75     	
;;;76     	if(mdGsm.sGsmComInfo.WorkFlage & GSM_RECV_NEW_DATA)
00003a  f8940602          LDRB     r0,[r4,#0x602]  ; mdGsm
00003e  0640              LSLS     r0,r0,#25
000040  d519              BPL      |L29.118|
;;;77     	{
;;;78     		/*返回ok代表开机过程成功*/
;;;79     		if(GsmRspCheckOK())
000042  f7fffffe          BL       GsmRspCheckOK
000046  b308              CBZ      r0,|L29.140|
;;;80     		{
;;;81     			LedOpen(LED1);
000048  2001              MOVS     r0,#1
00004a  f7fffffe          BL       LedOpen
;;;82     			mdGsm.uiGsmUsartFlag &=~GSM_SEND_ING;
00004e  f8b40604          LDRH     r0,[r4,#0x604]  ; mdGsm
000052  f0200080          BIC      r0,r0,#0x80
000056  f8a40604          STRH     r0,[r4,#0x604]
;;;83     			/*清楚模块正在发送过程中*/
;;;84     			mdGsm.sGsmComInfo.WorkFlage &=~GSM_RECV_NEW_DATA;
00005a  f8940602          LDRB     r0,[r4,#0x602]  ; mdGsm
00005e  f0200040          BIC      r0,r0,#0x40
000062  f8840602          STRB     r0,[r4,#0x602]
000066  f50464c0          ADD      r4,r4,#0x600
;;;85     			/*清楚接受到新数据*/
;;;86     			CleanGsmRsp();/*清空缓存区域*/
00006a  f7fffffe          BL       CleanGsmRsp
;;;87     			mdGsm.sGsmComInfo.RecvCount = 0;/*清空接受技术*/
00006e  7026              STRB     r6,[r4,#0]
;;;88     			return 1;
000070  2001              MOVS     r0,#1
                  |L29.114|
;;;89     			printf("%s\n",mdGsm.sGsmComInfo.RecvMessage);
;;;90     		}
;;;91     	}
;;;92     	else
;;;93     	{	
;;;94     		/*这里进行重试*/
;;;95     		if(CmdRepetTimes < GSM_REPET_TIMES)
;;;96     		{
;;;97     			CmdRepetTimes++;
;;;98     			mdGsm.uiGsmUsartFlag &= ~GSM_SEND_ING;
;;;99     		}
;;;100    		else
;;;101    		{
;;;102    			CmdRepetTimes = GSM_REPET_TIMES;
;;;103    		}
;;;104    			
;;;105    	}
;;;106    	
;;;107    	return 0;	/*错误*/
;;;108    }
000072  e8bd81f0          POP      {r4-r8,pc}
                  |L29.118|
000076  7868              LDRB     r0,[r5,#1]            ;95  ; CmdRepetTimes
000078  2804              CMP      r0,#4                 ;95
00007a  d208              BCS      |L29.142|
00007c  1c40              ADDS     r0,r0,#1              ;95
00007e  7068              STRB     r0,[r5,#1]            ;97
000080  f8b40604          LDRH     r0,[r4,#0x604]        ;98  ; mdGsm
000084  f0200080          BIC      r0,r0,#0x80           ;98
000088  f8a40604          STRH     r0,[r4,#0x604]        ;98
                  |L29.140|
00008c  e001              B        |L29.146|
                  |L29.142|
00008e  2004              MOVS     r0,#4                 ;102
000090  7068              STRB     r0,[r5,#1]            ;102
                  |L29.146|
000092  2000              MOVS     r0,#0                 ;107
000094  e7ed              B        |L29.114|
;;;109    /*gsm模块开机处理*/
                          ENDP

000096  0000              DCW      0x0000
                  |L29.152|
                          DCD      ||.bss||
                  |L29.156|
                          DCD      ||.data||
                  |L29.160|
                          DCD      ||.bss||+0x400

                          AREA ||i.SetGsmAteStr||, CODE, READONLY, ALIGN=2

                  SetGsmAteStr PROC
;;;41     /*准备回显需要发送的命令*/
;;;42     uint8_t SetGsmAteStr(uint8_t cmd)
000000  b510              PUSH     {r4,lr}
;;;43     {
000002  4604              MOV      r4,r0
;;;44     	memset(mdGsm.sGsmComInfo.SendMessage,0,GSM_SEND_BUF_LEN);
000004  f44f7100          MOV      r1,#0x200
000008  480c              LDR      r0,|L30.60|
00000a  f7fffffe          BL       __aeabi_memclr
;;;45     	/*清空缓存区*/
;;;46     	mdGsm.sGsmComInfo.SendMessage[0] = 'A';
00000e  490c              LDR      r1,|L30.64|
000010  2041              MOVS     r0,#0x41
;;;47     	mdGsm.sGsmComInfo.SendMessage[1] = 'T';
;;;48     	mdGsm.sGsmComInfo.SendMessage[2] = 'E';
000012  3430              ADDS     r4,r4,#0x30
000014  f8810400          STRB     r0,[r1,#0x400]        ;46
000018  2054              MOVS     r0,#0x54              ;47
00001a  f8810401          STRB     r0,[r1,#0x401]        ;47
00001e  2045              MOVS     r0,#0x45
000020  f8810402          STRB     r0,[r1,#0x402]
;;;49     	mdGsm.sGsmComInfo.SendMessage[3] = cmd + 0x30;
000024  f8814403          STRB     r4,[r1,#0x403]
;;;50     	mdGsm.sGsmComInfo.SendMessage[4] = '\r';
000028  200d              MOVS     r0,#0xd
00002a  f8810404          STRB     r0,[r1,#0x404]
;;;51     	mdGsm.sGsmComInfo.SendMessage[5] = '\n';
00002e  200a              MOVS     r0,#0xa
000030  f8810405          STRB     r0,[r1,#0x405]
;;;52     	mdGsm.sGsmComInfo.SendCount = 6;
000034  2006              MOVS     r0,#6
000036  f8810601          STRB     r0,[r1,#0x601]
;;;53     }
00003a  bd10              POP      {r4,pc}
;;;54     
                          ENDP

                  |L30.60|
                          DCD      ||.bss||+0x400
                  |L30.64|
                          DCD      ||.bss||

                          AREA ||i.SysGsmInit||, CODE, READONLY, ALIGN=2

                  SysGsmInit PROC
;;;975    }
;;;976    uint16_t SysGsmInit()
000000  b508              PUSH     {r3,lr}
;;;977    {
;;;978    	memset(&mdGsm,0,sizeof(GsmModeInfo));
000002  f2406126          MOV      r1,#0x626
000006  480c              LDR      r0,|L31.56|
000008  f7fffffe          BL       __aeabi_memclr
;;;979    	
;;;980    	GsmParmInit();
;;;981    	GsmPortInit();
00000c  f7fffffe          BL       GsmPortInit
;;;982    	USARTInit(GSM_USAET, GSM_BUAD, GSM_PORT, GSM_TXD, GSM_RXD);
000010  2008              MOVS     r0,#8
000012  9000              STR      r0,[sp,#0]
000014  2304              MOVS     r3,#4
000016  4a09              LDR      r2,|L31.60|
000018  f44f31e1          MOV      r1,#0x1c200
00001c  4808              LDR      r0,|L31.64|
00001e  f7fffffe          BL       USARTInit
;;;983    	
;;;984    	mdUsart.USART2_s.USARTUserDel = GsmRecvCmdDel;
000022  4909              LDR      r1,|L31.72|
000024  4807              LDR      r0,|L31.68|
;;;985    	
;;;986    	mdGsm.uiGsmUsartFlag |= GSM_USART_INIT_OK;/*gsm模块串口初始化完成*/
000026  61c8              STR      r0,[r1,#0x1c]  ; mdUsart
000028  4803              LDR      r0,|L31.56|
00002a  f8b01604          LDRH     r1,[r0,#0x604]  ; mdGsm
00002e  f0410101          ORR      r1,r1,#1
000032  f8a01604          STRH     r1,[r0,#0x604]
;;;987    }
000036  bd08              POP      {r3,pc}
                          ENDP

                  |L31.56|
                          DCD      ||.bss||
                  |L31.60|
                          DCD      0x40010800
                  |L31.64|
                          DCD      0x40004400
                  |L31.68|
                          DCD      GsmRecvCmdDel
                  |L31.72|
                          DCD      mdUsart

                          AREA ||.bss||, DATA, NOINIT, ALIGN=1

                  mdGsm
                          %        1574

                          AREA ||.data||, DATA, ALIGN=0

                  flage
000000  00                DCB      0x00
                  CmdRepetTimes
000001  00                DCB      0x00
